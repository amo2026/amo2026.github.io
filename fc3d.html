<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¦å½©3DåŒå·¥å…· Â· ç²¾ç®€ç‰ˆ</title>
    <style>
        /* å…¨å±€å¯¼èˆªæ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            padding: 12px 10px;
        }
        .nav-bar {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            background: white;
            border-radius: 16px;
            padding: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        .nav-btn {
            flex: 1;
            padding: 12px 6px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            background: transparent;
            color: #5a6e85;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            white-space: nowrap;
        }
        .nav-btn.active {
            background: #7f8fa6;
            color: white;
            box-shadow: 0 2px 6px rgba(127,143,166,0.3);
        }
        .tool-wrapper {
            display: none;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            padding: 0;
        }
        .tool-wrapper.active {
            display: block;
        }
        .tool1-container, .tool2-container {
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæŒ‰é’® -->
    <div class="nav-bar">
        <button class="nav-btn active" id="btnTool1">ğŸ¯ äº¤é›†è®¡ç®—</button>
        <button class="nav-btn" id="btnTool2">ğŸ” ç›´é€‰è¿‡æ»¤</button>
    </div>

    <!-- å·¥å…·1ï¼šäº¤é›†è®¡ç®—ç³»ç»Ÿï¼ˆæŒ‰é’®æ–‡å­—ä¿®æ”¹ï¼šå¤åˆ¶/ä¸‹è½½/åˆ é™¤ï¼‰ -->
    <div id="tool1-wrapper" class="tool-wrapper active">
        <div class="tool1-container">
            <style>
                .tool1-container {
                    all: initial;
                    display: block;
                    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
                    color: #333;
                    line-height: 1.4;
                    font-size: 13px;
                    background: white;
                    padding: 12px;
                }
                .tool1-container * {
                    box-sizing: border-box;
                    -webkit-tap-highlight-color: transparent;
                    -webkit-user-select: none;
                    user-select: none;
                }
                .tool1-container textarea {
                    -webkit-user-select: text;
                    user-select: text;
                }
                .tool1-container .card {
                    background: white;
                    border-radius: 8px;
                    padding: 12px 0;
                    box-shadow: none;
                    margin-bottom: 12px;
                }
                .tool1-container .textarea-container {
                    position: relative;
                    margin-bottom: 8px;
                }
                .tool1-container textarea {
                    width: 100%;
                    height: 70px;
                    padding: 8px;
                    border: 1.5px solid #e1e8ed;
                    border-radius: 6px;
                    font-size: 13px;
                    resize: vertical;
                    transition: border-color 0.2s;
                    line-height: 1.3;
                }
                .tool1-container textarea:focus {
                    outline: none;
                    border-color: #7f8fa6;
                }
                .tool1-container .textarea-label {
                    display: block;
                    margin-bottom: 5px;
                    font-weight: 600;
                    color: #2c3e50;
                    font-size: 0.85rem;
                }
                .tool1-container .input-count {
                    position: absolute;
                    top: 8px;
                    right: 10px;
                    font-size: 0.7rem;
                    color: #7f8c8d;
                    background: rgba(255,255,255,0.9);
                    padding: 1px 5px;
                    border-radius: 6px;
                }
                .tool1-container .btn {
                    padding: 10px 12px;
                    border: none;
                    border-radius: 6px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.15s;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 4px;
                    width: 100%;
                    margin-bottom: 6px;
                    touch-action: manipulation;
                }
                .tool1-container .btn-sm {
                    padding: 5px 8px;
                    font-size: 0.75rem;
                    width: auto;
                    margin: 0;
                }
                .tool1-container .btn-outline {
                    background: transparent;
                    color: #7f8fa6;
                    border: 1.5px solid #7f8fa6;
                }
                .tool1-container .btn-outline:active {
                    background: #7f8fa6;
                    color: white;
                    transform: translateY(1px);
                }
                .tool1-container .btn-success {
                    background: linear-gradient(to right, #9fb7c9, #7f8fa6);
                    color: white;
                }
                .tool1-container .btn-danger {
                    background: linear-gradient(to right, #e74c3c, #c0392b);
                    color: white;
                }
                .tool1-container .button-row {
                    display: flex;
                    gap: 6px;
                }
                .tool1-container .button-row .btn {
                    flex: 1;
                    margin-bottom: 0;
                }
                .tool1-container .condition-option-group {
                    background: #f0f7fa;
                    border-radius: 8px;
                    padding: 12px;
                    margin-top: 15px;
                    margin-bottom: 15px;
                    border: 1px solid #d9e6f2;
                }
                .tool1-container .option-title {
                    font-size: 0.9rem;
                    font-weight: 600;
                    color: #2c3e50;
                    margin-bottom: 10px;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }
                .tool1-container .radio-group {
                    display: flex;
                    gap: 20px;
                    margin-bottom: 12px;
                }
                .tool1-container .radio-label, .tool1-container .checkbox-label {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 0.85rem;
                    color: #333;
                }
                .tool1-container .checkbox-group {
                    display: flex;
                    gap: 16px;
                    flex-wrap: wrap;
                    margin-bottom: 8px;
                }
                .tool1-container .position-filter-header {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    margin-bottom: 10px;
                }
                .tool1-container .position-filter-header i {
                    width: 24px;
                    height: 24px;
                    background: #e1f0ff;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #7f8fa6;
                    font-size: 0.8rem;
                }
                .tool1-container .compact-position-selector {
                    margin: 10px 0;
                    padding: 10px;
                    background: #f8fafc;
                    border-radius: 6px;
                    border: 1px solid #eef2f7;
                }
                .tool1-container .position-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                .tool1-container .position-header h4 {
                    font-size: 0.85rem;
                    color: #2c3e50;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }
                .tool1-container .single-line-numbers {
                    display: flex;
                    justify-content: space-between;
                    gap: 4px;
                    overflow-x: auto;
                    padding: 4px 0;
                    scrollbar-width: none;
                }
                .tool1-container .single-line-numbers::-webkit-scrollbar { display: none; }
                .tool1-container .number-btn-small {
                    flex: 0 0 26px;
                    height: 26px;
                    border: none;
                    border-radius: 4px;
                    font-size: 0.8rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #f8fafc;
                    color: #7f8fa6;
                    border: 1px solid #e1e8ed;
                    touch-action: manipulation;
                }
                .tool1-container .number-btn-small.selected {
                    background: linear-gradient(to bottom right, #7f8fa6, #6b7b93);
                    color: white;
                    border-color: #6b7b93;
                }
                .tool1-container .number-btn-small.kill-selected {
                    background: linear-gradient(to bottom right, #e74c3c, #c0392b);
                    color: white;
                    border-color: #c0392b;
                }
                .tool1-container .badge {
                    display: inline-block;
                    padding: 2px 6px;
                    border-radius: 8px;
                    font-size: 0.7rem;
                    font-weight: 600;
                    margin-left: 4px;
                }
                .tool1-container .badge-blue {
                    background-color: #e1f0ff;
                    color: #7f8fa6;
                }
                .tool1-container .badge-red {
                    background-color: #fdeaea;
                    color: #e74c3c;
                }
                .tool1-container .results-container {
                    margin-top: 15px;
                }
                .tool1-container .results-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                    padding: 6px 10px;
                    background: #f0f7ff;
                    border-radius: 6px;
                }
                .tool1-container .results-count, .tool1-container .results-price {
                    font-size: 0.85rem;
                    font-weight: 600;
                }
                .tool1-container .results-count span {
                    color: #7f8fa6;
                    font-size: 0.95rem;
                }
                .tool1-container .results-price span {
                    color: #27ae60;
                    font-size: 0.95rem;
                }
                .tool1-container .results-display {
                    background: #f8f9fa;
                    border-radius: 6px;
                    padding: 8px;
                    min-height: 80px;
                    max-height: 300px;
                    overflow-y: auto;
                    border: 1px dashed #ced4da;
                    font-family: 'Consolas', 'Monaco', monospace;
                    line-height: 1.5;
                    white-space: pre-wrap;
                    font-size: 12px;
                    word-break: break-all;
                }
                .tool1-container .results-placeholder {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    height: 100%;
                    min-height: 60px;
                    color: #7f8c8d;
                    font-size: 0.85rem;
                }
                .tool1-container .number-item {
                    display: inline-block;
                    margin: 1px 2px;
                    padding: 3px 6px;
                    background: white;
                    border: 1px solid #e1e8ed;
                    border-radius: 4px;
                    cursor: pointer;
                    transition: all 0.2s;
                    position: relative;
                    font-size: 12px;
                }
                .tool1-container .number-item.selected {
                    background: #fff3cd;
                    border-color: #ffc107;
                    color: #856404;
                }
                .tool1-container .number-item .delete-btn {
                    position: absolute;
                    top: -6px;
                    right: -6px;
                    width: 16px;
                    height: 16px;
                    background: #e74c3c;
                    color: white;
                    border-radius: 50%;
                    display: none;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                    cursor: pointer;
                }
                .tool1-container .number-item.selected .delete-btn {
                    display: flex;
                }
                .tool1-container .remove-input-btn {
                    position: absolute;
                    bottom: 8px;
                    right: 10px;
                    background: #fee;
                    color: #c0392b;
                    border: 1px solid #f5c6cb;
                    border-radius: 4px;
                    padding: 3px 6px;
                    font-size: 0.7rem;
                    cursor: pointer;
                }
            </style>
            <!-- å·¥å…·1æ ¸å¿ƒå†…å®¹ -->
            <div class="tool1-container">
                <div class="textarea-container">
                    <label class="textarea-label">æ¡ä»¶ 1 (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):</label>
                    <textarea id="input1" placeholder="322 352 235 253 532 523 327"></textarea>
                    <div class="input-count">å·ç æ•°: <span id="count1">0</span></div>
                </div>
                <div class="textarea-container">
                    <label class="textarea-label">æ¡ä»¶ 2 (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):</label>
                    <textarea id="input2" placeholder="315 352 235 253 532 523 377"></textarea>
                    <div class="input-count">å·ç æ•°: <span id="count2">0</span></div>
                </div>
                <div id="intersection-inputs"></div>
                
                <div class="button-row">
                    <button class="btn btn-outline" id="add-input"><i class="fas fa-plus"></i> æ·»åŠ æ¡ä»¶</button>
                    <button class="btn btn-outline" id="clear-inputs"><i class="fas fa-broom"></i> æ¸…ç©ºæ¡ä»¶</button>
                </div>

                <!-- æ¡ä»¶é€‰é¡¹å¡ç‰‡ -->
                <div class="condition-option-group">
                    <div class="option-title"><i class="fas fa-sliders-h"></i> æ¡ä»¶é€‰é¡¹</div>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="generateType" value="direct" checked> ç”Ÿæˆæ‰€æœ‰ç›´é€‰</label>
                        <label class="radio-label"><input type="radio" name="generateType" value="group"> ç”Ÿæˆæ‰€æœ‰ç»„é€‰</label>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" id="includeG3" checked> åŒ…å«ç»„ä¸‰</label>
                        <label class="checkbox-label"><input type="checkbox" id="includeG6" checked> åŒ…å«ç»„å…­</label>
                        <label class="checkbox-label"><input type="checkbox" id="includeBZ" checked> åŒ…å«è±¹å­</label>
                    </div>
                </div>

                <!-- å®šä½ç­›é€‰ -->
                <div style="margin-top:5px;">
                    <div class="position-filter-header">
                        <i class="fas fa-bullseye"></i>
                        <span style="font-weight:600; color:#2c3e50;">å®šä½ç­›é€‰</span>
                    </div>
                    <!-- ç™¾ä½ -->
                    <div class="compact-position-selector">
                        <div class="position-header">
                            <h4>ç™¾ä½ <span class="badge badge-blue">é€‰å·</span><span class="badge badge-red">æ€å·</span></h4>
                            <button class="btn btn-outline btn-sm clear-position" data-position="hundred">æ¸…ç©º</button>
                        </div>
                        <div class="single-line-numbers" id="hundred"></div>
                        <div style="display:flex; justify-content:space-between; font-size:0.65rem; color:#888; margin-top:2px;">
                            <span>ç‚¹å‡»é€‰å·</span><span>é•¿æŒ‰æ€å·</span>
                        </div>
                    </div>
                    <!-- åä½ -->
                    <div class="compact-position-selector">
                        <div class="position-header">
                            <h4>åä½ <span class="badge badge-blue">é€‰å·</span><span class="badge badge-red">æ€å·</span></h4>
                            <button class="btn btn-outline btn-sm clear-position" data-position="ten">æ¸…ç©º</button>
                        </div>
                        <div class="single-line-numbers" id="ten"></div>
                    </div>
                    <!-- ä¸ªä½ -->
                    <div class="compact-position-selector">
                        <div class="position-header">
                            <h4>ä¸ªä½ <span class="badge badge-blue">é€‰å·</span><span class="badge badge-red">æ€å·</span></h4>
                            <button class="btn btn-outline btn-sm clear-position" data-position="unit">æ¸…ç©º</button>
                        </div>
                        <div class="single-line-numbers" id="unit"></div>
                    </div>
                    <!-- æ¸…ç©ºæ‰€æœ‰å®šä½æ¡ä»¶ -->
                    <div style="display:flex; justify-content:center; margin-top:10px;">
                        <label style="display:flex; align-items:center; gap:6px; font-size:0.8rem;">
                            <input type="checkbox" id="clear-all-conditions"> æ¸…ç©ºæ‰€æœ‰å®šä½æ¡ä»¶
                        </label>
                    </div>
                </div>

                <!-- è®¡ç®—æŒ‰é’® -->
                <div style="margin-top:15px;">
                    <button class="btn btn-success" id="calculate-intersection">
                        <i class="fas fa-calculator"></i> è®¡ç®—äº¤é›†
                    </button>
                </div>

                <!-- ç»“æœæ˜¾ç¤ºåŒº -->
                <div class="results-container">
                    <div class="results-header">
                        <div class="results-count">å…± <span id="result-count">0</span> æ³¨</div>
                        <div class="results-price">æ€»ä»·: <span id="result-price">0</span> å…ƒ (2å…ƒ/æ³¨)</div>
                    </div>
                    <div style="font-size:0.75rem; color:#666; margin-bottom:5px;">
                        <i class="fas fa-info-circle"></i> ç‚¹å‡»å·ç å¯é€‰ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’Ã—å¯åˆ é™¤
                    </div>
                    <div class="results-display" id="intersection-results">
                        <div class="results-placeholder">ç­‰å¾…è®¡ç®—ç»“æœ...</div>
                    </div>
                    <div class="button-row" style="margin-top:10px;">
                        <!-- ä¿®æ”¹æŒ‰é’®æ–‡å­—ï¼šå¤åˆ¶ / ä¸‹è½½ / åˆ é™¤ -->
                        <button class="btn btn-outline" id="copy-results"><i class="fas fa-copy"></i> å¤åˆ¶</button>
                        <button class="btn btn-outline" id="export-results"><i class="fas fa-download"></i> ä¸‹è½½</button>
                        <button class="btn btn-danger" id="delete-selected"><i class="fas fa-trash"></i> åˆ é™¤</button>
                    </div>
                </div>
            </div>
            <!-- å·¥å…·1è„šæœ¬ï¼ˆä¿æŒä¸å˜ï¼Œä½†éœ€ç¡®ä¿æŒ‰é’®IDæ­£ç¡®ï¼‰ -->
            <script>
                (function() {
                    let currentResults = [];
                    function initNumberSelectors() {
                        const positions = ['hundred', 'ten', 'unit'];
                        positions.forEach(pos => {
                            const container = document.getElementById(pos);
                            if (!container) return;
                            container.innerHTML = '';
                            for (let i = 0; i <= 9; i++) {
                                const btn = document.createElement('button');
                                btn.className = 'number-btn-small';
                                btn.textContent = i;
                                btn.dataset.number = i;
                                let timer, isLongPress = false;
                                btn.addEventListener('contextmenu', e => e.preventDefault());
                                btn.addEventListener('click', function(e) {
                                    if (!isLongPress) {
                                        if (this.classList.contains('kill-selected')) {
                                            this.classList.remove('kill-selected');
                                        } else if (this.classList.contains('selected')) {
                                            this.classList.remove('selected');
                                        } else {
                                            this.classList.add('selected');
                                        }
                                    }
                                    isLongPress = false;
                                });
                                const startLongPress = function(e) {
                                    timer = setTimeout(() => {
                                        isLongPress = true;
                                        if (this.classList.contains('selected')) {
                                            this.classList.remove('selected');
                                        } else if (this.classList.contains('kill-selected')) {
                                            this.classList.remove('kill-selected');
                                        } else {
                                            this.classList.add('kill-selected');
                                        }
                                    }, 500);
                                }.bind(btn);
                                btn.addEventListener('touchstart', startLongPress);
                                btn.addEventListener('touchend', () => clearTimeout(timer));
                                btn.addEventListener('touchmove', () => clearTimeout(timer));
                                btn.addEventListener('mousedown', startLongPress);
                                btn.addEventListener('mouseup', () => clearTimeout(timer));
                                btn.addEventListener('mouseleave', () => clearTimeout(timer));
                                container.appendChild(btn);
                            }
                        });
                        document.querySelectorAll('.clear-position').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const pos = this.dataset.position;
                                document.querySelectorAll(`#${pos} .number-btn-small`).forEach(b => {
                                    b.classList.remove('selected', 'kill-selected');
                                });
                            });
                        });
                        document.getElementById('clear-all-conditions')?.addEventListener('change', function() {
                            if (this.checked) {
                                document.querySelectorAll('.single-line-numbers .number-btn-small').forEach(b => {
                                    b.classList.remove('selected', 'kill-selected');
                                });
                                this.checked = false;
                            }
                        });
                    }
                    function initInputCounters() {
                        ['input1', 'input2'].forEach(id => {
                            const input = document.getElementById(id);
                            const span = document.getElementById(`count${id.slice(-1)}`);
                            if (!input || !span) return;
                            const update = () => {
                                const nums = input.value.trim() ? input.value.trim().split(/\s+/).filter(n => n.length===3) : [];
                                span.textContent = nums.length;
                            };
                            input.addEventListener('input', update);
                            update();
                        });
                    }
                    document.getElementById('add-input').addEventListener('click', function() {
                        const container = document.getElementById('intersection-inputs');
                        const idx = document.querySelectorAll('.textarea-container').length + 1;
                        const div = document.createElement('div');
                        div.className = 'textarea-container';
                        div.innerHTML = `
                            <label class="textarea-label">æ¡ä»¶ ${idx} (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):</label>
                            <textarea id="input${idx}" placeholder="ç²˜è´´3Då·ç ï¼Œç”¨ç©ºæ ¼åˆ†éš”..."></textarea>
                            <div class="input-count">å·ç æ•°: <span id="count${idx}">0</span></div>
                            <button class="remove-input-btn" data-remove-input="${idx}"><i class="fas fa-times"></i> åˆ é™¤</button>
                        `;
                        container.appendChild(div);
                        const input = document.getElementById(`input${idx}`);
                        const span = document.getElementById(`count${idx}`);
                        input.addEventListener('input', function() {
                            const nums = this.value.trim() ? this.value.trim().split(/\s+/).filter(n => n.length===3) : [];
                            span.textContent = nums.length;
                        });
                        div.querySelector(`[data-remove-input="${idx}"]`).addEventListener('click', function() {
                            if (document.querySelectorAll('.textarea-container').length > 2) {
                                div.remove();
                                document.querySelectorAll('.textarea-container').forEach((c, i) => {
                                    const inp = c.querySelector('textarea');
                                    const lbl = c.querySelector('.textarea-label');
                                    const cnt = c.querySelector('.input-count span');
                                    const del = c.querySelector('[data-remove-input]');
                                    const newId = i + 1;
                                    inp.id = `input${newId}`;
                                    lbl.textContent = `æ¡ä»¶ ${newId} (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):`;
                                    cnt.id = `count${newId}`;
                                    if (del) del.dataset.removeInput = newId;
                                });
                            } else alert('è‡³å°‘ä¿ç•™ä¸¤ä¸ªæ¡ä»¶æ¡†');
                        });
                    });
                    document.getElementById('clear-inputs').addEventListener('click', function() {
                        if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ¡ä»¶æ¡†ï¼Ÿ')) {
                            document.querySelectorAll('textarea[id^="input"]').forEach(inp => {
                                inp.value = '';
                                const id = inp.id.slice(-1);
                                const span = document.getElementById(`count${id}`);
                                if (span) span.textContent = '0';
                            });
                        }
                    });
                    function generateConditionPool() {
                        const isDirect = document.querySelector('input[name="generateType"]:checked').value === 'direct';
                        const includeG3 = document.getElementById('includeG3').checked;
                        const includeG6 = document.getElementById('includeG6').checked;
                        const includeBZ = document.getElementById('includeBZ').checked;
                        if (!includeG3 && !includeG6 && !includeBZ) return [];
                        const pool = new Set();
                        if (isDirect) {
                            for (let i = 0; i <= 999; i++) {
                                const num = i.toString().padStart(3, '0');
                                const d1=num[0], d2=num[1], d3=num[
