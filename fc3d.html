<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¦å½©3Dä¸‰å·¥å…· Â· å®Œæ•´ç‰ˆ</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        /* å…¨å±€å¯¼èˆªæ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            padding: 12px 10px;
        }
        .nav-bar {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 16px;
            background: white;
            border-radius: 16px;
            padding: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        .nav-btn {
            flex: 1;
            padding: 12px 6px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            background: transparent;
            color: #5a6e85;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            white-space: nowrap;
        }
        .nav-btn.active {
            background: #7f8fa6;
            color: white;
            box-shadow: 0 2px 6px rgba(127,143,166,0.3);
        }
        .tool-wrapper {
            display: none;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            padding: 0;
        }
        .tool-wrapper.active {
            display: block;
        }
        /* å·¥å…·å†…éƒ¨å®¹å™¨ */
        .tool1-container, .tool2-container, .tool3-container {
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæŒ‰é’® (ä¸‰ä¸ª) -->
    <div class="nav-bar">
        <button class="nav-btn active" id="btnTool1">ğŸ¯ äº¤é›†è®¡ç®—</button>
        <button class="nav-btn" id="btnTool2">ğŸ“œ å†å²è¿‡æ»¤</button>
        <button class="nav-btn" id="btnTool3">ğŸ”¢ åˆ†è§£</button>
    </div>

    <!-- ========= å·¥å…·1ï¼šäº¤é›†è®¡ç®— (å®Œæ•´) ========= -->
    <div id="tool1-wrapper" class="tool-wrapper active">
        <div class="tool1-container">
            <style>
                .tool1-container {
                    all: initial;
                    display: block;
                    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
                    color: #333;
                    line-height: 1.4;
                    font-size: 13px;
                    background: white;
                    padding: 12px;
                }
                .tool1-container * {
                    box-sizing: border-box;
                    -webkit-tap-highlight-color: transparent;
                    -webkit-user-select: none;
                    user-select: none;
                }
                .tool1-container textarea {
                    -webkit-user-select: text;
                    user-select: text;
                }
                .tool1-container .card {
                    background: white;
                    border-radius: 8px;
                    padding: 12px 0;
                    box-shadow: none;
                    margin-bottom: 12px;
                }
                .tool1-container .textarea-container {
                    position: relative;
                    margin-bottom: 8px;
                }
                .tool1-container textarea {
                    width: 100%;
                    height: 70px;
                    padding: 8px;
                    border: 1.5px solid #e1e8ed;
                    border-radius: 6px;
                    font-size: 13px;
                    resize: vertical;
                    transition: border-color 0.2s;
                    line-height: 1.3;
                }
                .tool1-container textarea:focus {
                    outline: none;
                    border-color: #7f8fa6;
                }
                .tool1-container .textarea-label {
                    display: block;
                    margin-bottom: 5px;
                    font-weight: 600;
                    color: #2c3e50;
                    font-size: 0.85rem;
                }
                .tool1-container .input-count {
                    position: absolute;
                    top: 8px;
                    right: 10px;
                    font-size: 0.7rem;
                    color: #7f8c8d;
                    background: rgba(255,255,255,0.9);
                    padding: 1px 5px;
                    border-radius: 6px;
                }
                .tool1-container .btn {
                    padding: 10px 12px;
                    border: none;
                    border-radius: 6px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.15s;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 4px;
                    width: 100%;
                    margin-bottom: 6px;
                    touch-action: manipulation;
                }
                .tool1-container .btn-sm {
                    padding: 5px 8px;
                    font-size: 0.75rem;
                    width: auto;
                    margin: 0;
                }
                .tool1-container .btn-outline {
                    background: transparent;
                    color: #7f8fa6;
                    border: 1.5px solid #7f8fa6;
                }
                .tool1-container .btn-outline:active {
                    background: #7f8fa6;
                    color: white;
                    transform: translateY(1px);
                }
                .tool1-container .btn-success {
                    background: linear-gradient(to right, #9fb7c9, #7f8fa6);
                    color: white;
                }
                .tool1-container .btn-danger {
                    background: linear-gradient(to right, #e74c3c, #c0392b);
                    color: white;
                }
                .tool1-container .button-row {
                    display: flex;
                    gap: 6px;
                }
                .tool1-container .button-row .btn {
                    flex: 1;
                    margin-bottom: 0;
                }
                .tool1-container .condition-option-group {
                    background: #f0f7fa;
                    border-radius: 8px;
                    padding: 12px;
                    margin-top: 15px;
                    margin-bottom: 15px;
                    border: 1px solid #d9e6f2;
                }
                .tool1-container .option-title {
                    font-size: 0.9rem;
                    font-weight: 600;
                    color: #2c3e50;
                    margin-bottom: 10px;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }
                .tool1-container .radio-group {
                    display: flex;
                    gap: 20px;
                    margin-bottom: 12px;
                }
                .tool1-container .radio-label, .tool1-container .checkbox-label {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 0.85rem;
                    color: #333;
                }
                .tool1-container .checkbox-group {
                    display: flex;
                    gap: 16px;
                    flex-wrap: wrap;
                    margin-bottom: 8px;
                }
                .tool1-container .position-filter-header {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    margin-bottom: 10px;
                }
                .tool1-container .position-filter-header i {
                    width: 24px;
                    height: 24px;
                    background: #e1f0ff;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #7f8fa6;
                    font-size: 0.8rem;
                }
                .tool1-container .compact-position-selector {
                    margin: 10px 0;
                    padding: 10px;
                    background: #f8fafc;
                    border-radius: 6px;
                    border: 1px solid #eef2f7;
                }
                .tool1-container .position-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                .tool1-container .position-header h4 {
                    font-size: 0.85rem;
                    color: #2c3e50;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }
                .tool1-container .single-line-numbers {
                    display: flex;
                    justify-content: space-between;
                    gap: 4px;
                    overflow-x: auto;
                    padding: 4px 0;
                    scrollbar-width: none;
                }
                .tool1-container .single-line-numbers::-webkit-scrollbar { display: none; }
                .tool1-container .number-btn-small {
                    flex: 0 0 26px;
                    height: 26px;
                    border: none;
                    border-radius: 4px;
                    font-size: 0.8rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #f8fafc;
                    color: #7f8fa6;
                    border: 1px solid #e1e8ed;
                    touch-action: manipulation;
                }
                .tool1-container .number-btn-small.selected {
                    background: linear-gradient(to bottom right, #7f8fa6, #6b7b93);
                    color: white;
                    border-color: #6b7b93;
                }
                .tool1-container .number-btn-small.kill-selected {
                    background: linear-gradient(to bottom right, #e74c3c, #c0392b);
                    color: white;
                    border-color: #c0392b;
                }
                .tool1-container .badge {
                    display: inline-block;
                    padding: 2px 6px;
                    border-radius: 8px;
                    font-size: 0.7rem;
                    font-weight: 600;
                    margin-left: 4px;
                }
                .tool1-container .badge-blue {
                    background-color: #e1f0ff;
                    color: #7f8fa6;
                }
                .tool1-container .badge-red {
                    background-color: #fdeaea;
                    color: #e74c3c;
                }
                .tool1-container .results-container {
                    margin-top: 15px;
                }
                .tool1-container .results-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                    padding: 6px 10px;
                    background: #f0f7ff;
                    border-radius: 6px;
                }
                .tool1-container .results-count, .tool1-container .results-price {
                    font-size: 0.85rem;
                    font-weight: 600;
                }
                .tool1-container .results-count span {
                    color: #7f8fa6;
                    font-size: 0.95rem;
                }
                .tool1-container .results-price span {
                    color: #27ae60;
                    font-size: 0.95rem;
                }
                .tool1-container .results-display {
                    background: #f8f9fa;
                    border-radius: 6px;
                    padding: 8px;
                    min-height: 80px;
                    max-height: 300px;
                    overflow-y: auto;
                    border: 1px dashed #ced4da;
                    font-family: 'Consolas', 'Monaco', monospace;
                    line-height: 1.5;
                    white-space: pre-wrap;
                    font-size: 12px;
                    word-break: break-all;
                }
                .tool1-container .results-placeholder {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    height: 100%;
                    min-height: 60px;
                    color: #7f8c8d;
                    font-size: 0.85rem;
                }
                .tool1-container .number-item {
                    display: inline-block;
                    margin: 1px 2px;
                    padding: 3px 6px;
                    background: white;
                    border: 1px solid #e1e8ed;
                    border-radius: 4px;
                    cursor: pointer;
                    transition: all 0.2s;
                    position: relative;
                    font-size: 12px;
                }
                .tool1-container .number-item.selected {
                    background: #fff3cd;
                    border-color: #ffc107;
                    color: #856404;
                }
                .tool1-container .number-item .delete-btn {
                    position: absolute;
                    top: -6px;
                    right: -6px;
                    width: 16px;
                    height: 16px;
                    background: #e74c3c;
                    color: white;
                    border-radius: 50%;
                    display: none;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                    cursor: pointer;
                }
                .tool1-container .number-item.selected .delete-btn {
                    display: flex;
                }
                .tool1-container .remove-input-btn {
                    position: absolute;
                    bottom: 8px;
                    right: 10px;
                    background: #fee;
                    color: #c0392b;
                    border: 1px solid #f5c6cb;
                    border-radius: 4px;
                    padding: 3px 6px;
                    font-size: 0.7rem;
                    cursor: pointer;
                }
            </style>
            <div class="tool1-container">
                <div class="textarea-container">
                    <label class="textarea-label">æ¡ä»¶ 1 (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):</label>
                    <textarea id="input1" placeholder="322 352 235 253 532 523 327"></textarea>
                    <div class="input-count">å·ç æ•°: <span id="count1">0</span></div>
                </div>
                <div class="textarea-container">
                    <label class="textarea-label">æ¡ä»¶ 2 (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):</label>
                    <textarea id="input2" placeholder="315 352 235 253 532 523 377"></textarea>
                    <div class="input-count">å·ç æ•°: <span id="count2">0</span></div>
                </div>
                <div id="intersection-inputs"></div>
                
                <div class="button-row">
                    <button class="btn btn-outline" id="add-input"><i class="fas fa-plus"></i> æ·»åŠ æ¡ä»¶</button>
                    <button class="btn btn-outline" id="clear-inputs"><i class="fas fa-broom"></i> æ¸…ç©ºæ¡ä»¶</button>
                </div>

                <div class="condition-option-group">
                    <div class="option-title"><i class="fas fa-sliders-h"></i> æ¡ä»¶é€‰é¡¹</div>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="generateType" value="direct" checked> ç”Ÿæˆæ‰€æœ‰ç›´é€‰</label>
                        <label class="radio-label"><input type="radio" name="generateType" value="group"> ç”Ÿæˆæ‰€æœ‰ç»„é€‰</label>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" id="includeG3" checked> åŒ…å«ç»„ä¸‰</label>
                        <label class="checkbox-label"><input type="checkbox" id="includeG6" checked> åŒ…å«ç»„å…­</label>
                        <label class="checkbox-label"><input type="checkbox" id="includeBZ" checked> åŒ…å«è±¹å­</label>
                    </div>
                </div>

                <div style="margin-top:5px;">
                    <div class="position-filter-header">
                        <i class="fas fa-bullseye"></i>
                        <span style="font-weight:600; color:#2c3e50;">å®šä½ç­›é€‰</span>
                    </div>
                    <div class="compact-position-selector">
                        <div class="position-header">
                            <h4>ç™¾ä½ <span class="badge badge-blue">é€‰å·</span><span class="badge badge-red">æ€å·</span></h4>
                            <button class="btn btn-outline btn-sm clear-position" data-position="hundred">æ¸…ç©º</button>
                        </div>
                        <div class="single-line-numbers" id="hundred"></div>
                        <div style="display:flex; justify-content:space-between; font-size:0.65rem; color:#888; margin-top:2px;">
                            <span>ç‚¹å‡»é€‰å·</span><span>é•¿æŒ‰æ€å·</span>
                        </div>
                    </div>
                    <div class="compact-position-selector">
                        <div class="position-header">
                            <h4>åä½ <span class="badge badge-blue">é€‰å·</span><span class="badge badge-red">æ€å·</span></h4>
                            <button class="btn btn-outline btn-sm clear-position" data-position="ten">æ¸…ç©º</button>
                        </div>
                        <div class="single-line-numbers" id="ten"></div>
                    </div>
                    <div class="compact-position-selector">
                        <div class="position-header">
                            <h4>ä¸ªä½ <span class="badge badge-blue">é€‰å·</span><span class="badge badge-red">æ€å·</span></h4>
                            <button class="btn btn-outline btn-sm clear-position" data-position="unit">æ¸…ç©º</button>
                        </div>
                        <div class="single-line-numbers" id="unit"></div>
                    </div>
                    <div style="display:flex; justify-content:center; margin-top:10px;">
                        <label style="display:flex; align-items:center; gap:6px; font-size:0.8rem;">
                            <input type="checkbox" id="clear-all-conditions"> æ¸…ç©ºæ‰€æœ‰å®šä½æ¡ä»¶
                        </label>
                    </div>
                </div>

                <div style="margin-top:15px;">
                    <button class="btn btn-success" id="calculate-intersection">
                        <i class="fas fa-calculator"></i> è®¡ç®—äº¤é›†
                    </button>
                </div>

                <div class="results-container">
                    <div class="results-header">
                        <div class="results-count">å…± <span id="result-count">0</span> æ³¨</div>
                        <div class="results-price">æ€»ä»·: <span id="result-price">0</span> å…ƒ (2å…ƒ/æ³¨)</div>
                    </div>
                    <div style="font-size:0.75rem; color:#666; margin-bottom:5px;">
                        <i class="fas fa-info-circle"></i> ç‚¹å‡»å·ç å¯é€‰ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’Ã—å¯åˆ é™¤
                    </div>
                    <div class="results-display" id="intersection-results">
                        <div class="results-placeholder">ç­‰å¾…è®¡ç®—ç»“æœ...</div>
                    </div>
                    <div class="button-row" style="margin-top:10px;">
                        <button class="btn btn-outline" id="copy-results"><i class="fas fa-copy"></i> å¤åˆ¶</button>
                        <button class="btn btn-outline" id="export-results"><i class="fas fa-download"></i> ä¸‹è½½</button>
                        <button class="btn btn-danger" id="delete-selected"><i class="fas fa-trash"></i> åˆ é™¤</button>
                    </div>
                </div>
            </div>
            <script>
                (function() {
                    let currentResults = [];
                    function initNumberSelectors() {
                        const positions = ['hundred', 'ten', 'unit'];
                        positions.forEach(pos => {
                            const container = document.getElementById(pos);
                            if (!container) return;
                            container.innerHTML = '';
                            for (let i = 0; i <= 9; i++) {
                                const btn = document.createElement('button');
                                btn.className = 'number-btn-small';
                                btn.textContent = i;
                                btn.dataset.number = i;
                                let timer, isLongPress = false;
                                btn.addEventListener('contextmenu', e => e.preventDefault());
                                btn.addEventListener('click', function(e) {
                                    if (!isLongPress) {
                                        if (this.classList.contains('kill-selected')) {
                                            this.classList.remove('kill-selected');
                                        } else if (this.classList.contains('selected')) {
                                            this.classList.remove('selected');
                                        } else {
                                            this.classList.add('selected');
                                        }
                                    }
                                    isLongPress = false;
                                });
                                const startLongPress = function(e) {
                                    timer = setTimeout(() => {
                                        isLongPress = true;
                                        if (this.classList.contains('selected')) {
                                            this.classList.remove('selected');
                                        } else if (this.classList.contains('kill-selected')) {
                                            this.classList.remove('kill-selected');
                                        } else {
                                            this.classList.add('kill-selected');
                                        }
                                    }, 500);
                                }.bind(btn);
                                btn.addEventListener('touchstart', startLongPress);
                                btn.addEventListener('touchend', () => clearTimeout(timer));
                                btn.addEventListener('touchmove', () => clearTimeout(timer));
                                btn.addEventListener('mousedown', startLongPress);
                                btn.addEventListener('mouseup', () => clearTimeout(timer));
                                btn.addEventListener('mouseleave', () => clearTimeout(timer));
                                container.appendChild(btn);
                            }
                        });
                        document.querySelectorAll('.clear-position').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const pos = this.dataset.position;
                                document.querySelectorAll(`#${pos} .number-btn-small`).forEach(b => {
                                    b.classList.remove('selected', 'kill-selected');
                                });
                            });
                        });
                        document.getElementById('clear-all-conditions')?.addEventListener('change', function() {
                            if (this.checked) {
                                document.querySelectorAll('.single-line-numbers .number-btn-small').forEach(b => {
                                    b.classList.remove('selected', 'kill-selected');
                                });
                                this.checked = false;
                            }
                        });
                    }
                    function initInputCounters() {
                        ['input1', 'input2'].forEach(id => {
                            const input = document.getElementById(id);
                            const span = document.getElementById(`count${id.slice(-1)}`);
                            if (!input || !span) return;
                            const update = () => {
                                const nums = input.value.trim() ? input.value.trim().split(/\s+/).filter(n => n.length===3) : [];
                                span.textContent = nums.length;
                            };
                            input.addEventListener('input', update);
                            update();
                        });
                    }
                    document.getElementById('add-input').addEventListener('click', function() {
                        const container = document.getElementById('intersection-inputs');
                        const idx = document.querySelectorAll('.textarea-container').length + 1;
                        const div = document.createElement('div');
                        div.className = 'textarea-container';
                        div.innerHTML = `
                            <label class="textarea-label">æ¡ä»¶ ${idx} (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):</label>
                            <textarea id="input${idx}" placeholder="ç²˜è´´3Då·ç ï¼Œç”¨ç©ºæ ¼åˆ†éš”..."></textarea>
                            <div class="input-count">å·ç æ•°: <span id="count${idx}">0</span></div>
                            <button class="remove-input-btn" data-remove-input="${idx}"><i class="fas fa-times"></i> åˆ é™¤</button>
                        `;
                        container.appendChild(div);
                        const input = document.getElementById(`input${idx}`);
                        const span = document.getElementById(`count${idx}`);
                        input.addEventListener('input', function() {
                            const nums = this.value.trim() ? this.value.trim().split(/\s+/).filter(n => n.length===3) : [];
                            span.textContent = nums.length;
                        });
                        div.querySelector(`[data-remove-input="${idx}"]`).addEventListener('click', function() {
                            if (document.querySelectorAll('.textarea-container').length > 2) {
                                div.remove();
                                document.querySelectorAll('.textarea-container').forEach((c, i) => {
                                    const inp = c.querySelector('textarea');
                                    const lbl = c.querySelector('.textarea-label');
                                    const cnt = c.querySelector('.input-count span');
                                    const del = c.querySelector('[data-remove-input]');
                                    const newId = i + 1;
                                    inp.id = `input${newId}`;
                                    lbl.textContent = `æ¡ä»¶ ${newId} (3Då·ç ï¼Œç©ºæ ¼åˆ†éš”):`;
                                    cnt.id = `count${newId}`;
                                    if (del) del.dataset.removeInput = newId;
                                });
                            } else alert('è‡³å°‘ä¿ç•™ä¸¤ä¸ªæ¡ä»¶æ¡†');
                        });
                    });
                    document.getElementById('clear-inputs').addEventListener('click', function() {
                        if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ¡ä»¶æ¡†ï¼Ÿ')) {
                            document.querySelectorAll('textarea[id^="input"]').forEach(inp => {
                                inp.value = '';
                                const id = inp.id.slice(-1);
                                const span = document.getElementById(`count${id}`);
                                if (span) span.textContent = '0';
                            });
                        }
                    });
                    function generateConditionPool() {
                        const isDirect = document.querySelector('input[name="generateType"]:checked').value === 'direct';
                        const includeG3 = document.getElementById('includeG3').checked;
                        const includeG6 = document.getElementById('includeG6').checked;
                        const includeBZ = document.getElementById('includeBZ').checked;
                        if (!includeG3 && !includeG6 && !includeBZ) return [];
                        const pool = new Set();
                        if (isDirect) {
                            for (let i = 0; i <= 999; i++) {
                                const num = i.toString().padStart(3, '0');
                                const d1=num[0], d2=num[1], d3=num[2];
                                if (d1===d2 && d2===d3) { if (includeBZ) pool.add(num); }
                                else if (d1===d2 || d2===d3 || d1===d3) { if (includeG3) pool.add(num); }
                                else { if (includeG6) pool.add(num); }
                            }
                        } else {
                            if (includeBZ) for (let i=0;i<=9;i++) pool.add(i.toString().repeat(3));
                            if (includeG3) {
                                for (let a=0;a<=9;a++) for (let b=0;b<=9;b++) {
                                    if (a===b) continue;
                                    pool.add(`${a}${a}${b}`); pool.add(`${a}${b}${a}`); pool.add(`${b}${a}${a}`);
                                }
                            }
                            if (includeG6) {
                                for (let a=0;a<=9;a++) for (let b=a+1;b<=9;b++) for (let c=b+1;c<=9;c++) {
                                    const arr=[a,b,c]; const perms=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]];
                                    perms.forEach(p => pool.add(`${arr[p[0]]}${arr[p[1]]}${arr[p[2]]}`));
                                }
                            }
                        }
                        return Array.from(pool);
                    }
                    function getPositionConditions() {
                        const cond = { hundredSelect:[], tenSelect:[], unitSelect:[], hundredKill:[], tenKill:[], unitKill:[] };
                        ['hundred','ten','unit'].forEach(pos => {
                            document.querySelectorAll(`#${pos} .number-btn-small`).forEach(btn => {
                                if (btn.classList.contains('selected')) cond[`${pos}Select`].push(btn.dataset.number);
                                else if (btn.classList.contains('kill-selected')) cond[`${pos}Kill`].push(btn.dataset.number);
                            });
                        });
                        return cond;
                    }
                    function applyPositionFilter(numbers, cond) {
                        return numbers.filter(num => {
                            const h=num[0], t=num[1], u=num[2];
                            if (cond.hundredSelect.length && !cond.hundredSelect.includes(h)) return false;
                            if (cond.tenSelect.length && !cond.tenSelect.includes(t)) return false;
                            if (cond.unitSelect.length && !cond.unitSelect.includes(u)) return false;
                            if (cond.hundredKill.length && cond.hundredKill.includes(h)) return false;
                            if (cond.tenKill.length && cond.tenKill.includes(t)) return false;
                            if (cond.unitKill.length && cond.unitKill.includes(u)) return false;
                            return true;
                        });
                    }
                    function renderResults(nums) {
                        const container = document.getElementById('intersection-results');
                        container.innerHTML = '';
                        if (nums.length === 0) {
                            container.innerHTML = '<div class="results-placeholder">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å·ç </div>';
                            return;
                        }
                        const sorted = nums.sort((a,b) => a[0].localeCompare(b[0]));
                        sorted.forEach((num, idx) => {
                            const span = document.createElement('span');
                            span.className = 'number-item';
                            span.textContent = num;
                            span.dataset.number = num;
                            const del = document.createElement('span');
                            del.className = 'delete-btn';
                            del.innerHTML = 'Ã—';
                            span.appendChild(del);
                            span.addEventListener('click', function(e) {
                                if (e.target !== del) this.classList.toggle('selected');
                            });
                            del.addEventListener('click', (e) => {
                                e.stopPropagation();
                                if (confirm(`åˆ é™¤å·ç  ${span.dataset.number} ï¼Ÿ`)) {
                                    const idx = currentResults.indexOf(span.dataset.number);
                                    if (idx > -1) currentResults.splice(idx,1);
                                    renderResults(currentResults);
                                    updateStats();
                                }
                            });
                            container.appendChild(span);
                            if ((idx+1) % 7 === 0) container.appendChild(document.createElement('br'));
                        });
                    }
                    function updateStats() {
                        document.getElementById('result-count').textContent = currentResults.length;
                        document.getElementById('result-price').textContent = currentResults.length * 2;
                    }
                    document.getElementById('calculate-intersection').addEventListener('click', function() {
                        const sets = [];
                        document.querySelectorAll('textarea[id^="input"]').forEach(input => {
                            const text = input.value.trim();
                            if (text) {
                                const nums = text.split(/\s+/).filter(n => n.length===3);
                                if (nums.length) sets.push(new Set(nums));
                            }
                        });
                        if (sets.length < 2) { alert('è¯·è‡³å°‘å¡«å†™ä¸¤ä¸ªæ¡ä»¶æ¡†çš„å·ç '); return; }
                        const pool = generateConditionPool();
                        if (pool.length === 0) { alert('å½“å‰å½¢æ€è®¾ç½®ä¸‹æ²¡æœ‰ç”Ÿæˆä»»ä½•å·ç ï¼Œè¯·è‡³å°‘å‹¾é€‰ä¸€ç§åŒ…å«ç±»å‹'); return; }
                        sets.unshift(new Set(pool));
                        let intersection = [...sets[0]];
                        for (let i = 1; i < sets.length; i++) intersection = intersection.filter(n => sets[i].has(n));
                        const posCond = getPositionConditions();
                        if (Object.values(posCond).some(arr => arr.length)) intersection = applyPositionFilter(intersection, posCond);
                        currentResults = intersection;
                        renderResults(currentResults);
                        updateStats();
                    });
                    document.getElementById('copy-results').addEventListener('click', function() {
                        if (!currentResults.length) return alert('æ²¡æœ‰å¯å¤åˆ¶çš„ç»“æœ');
                        let text = '';
                        currentResults.forEach((n,i) => { text += n + ' '; if ((i+1)%7===0) text += '\n'; });
                        navigator.clipboard.writeText(text.trim()).then(() => alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')).catch(() => { alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'); });
                    });
                    document.getElementById('export-results').addEventListener('click', function() {
                        if (!currentResults.length) return alert('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»“æœ');
                        let resultText = '';
                        currentResults.forEach((n,i) => { resultText += n + ' '; if ((i+1)%7===0) resultText += '\n'; });
                        const cond = getPositionConditions();
                        let condStr = '';
                        ['hundred','ten','unit'].forEach(p => { if(cond[`${p}Select`].length) condStr += `${p==='hundred'?'ç™¾ä½':p==='ten'?'åä½':'ä¸ªä½'}é€‰å·: ${cond[`${p}Select`].join(' ')}\n`; if(cond[`${p}Kill`].length) condStr += `${p==='hundred'?'ç™¾ä½':p==='ten'?'åä½':'ä¸ªä½'}æ€å·: ${cond[`${p}Kill`].join(' ')}\n`; });
                        const content = `ç¦å½©3Däº¤é›†è®¡ç®—ç»“æœ\nç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}\n\nç­›é€‰æ¡ä»¶:\n${condStr || 'æ— '}\näº¤é›†ç»“æœ (${currentResults.length}æ³¨ï¼Œæ€»ä»·${currentResults.length*2}å…ƒ):\n${resultText.trim()}`;
                        const blob = new Blob([content], {type:'text/plain'});
                        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `3Däº¤é›†ç»“æœ_${Date.now()}.txt`; a.click(); URL.revokeObjectURL(a.href);
                    });
                    document.getElementById('delete-selected').addEventListener('click', function() {
                        const selected = document.querySelectorAll('.number-item.selected');
                        if (!selected.length) return alert('è¯·å…ˆé€‰ä¸­è¦åˆ é™¤çš„å·ç ');
                        if (confirm(`ç¡®å®šåˆ é™¤é€‰ä¸­çš„ ${selected.length} ä¸ªå·ç ï¼Ÿ`)) {
                            const toDel = new Set(Array.from(selected).map(el => el.dataset.number));
                            currentResults = currentResults.filter(n => !toDel.has(n));
                            renderResults(currentResults);
                            updateStats();
                        }
                    });
                    initNumberSelectors();
                    initInputCounters();
                    document.getElementById('intersection-results').innerHTML = '<div class="results-placeholder">ç­‰å¾…è®¡ç®—ç»“æœ...</div>';
                })();
            </script>
        </div>
    </div>

    <!-- ========= å·¥å…·2ï¼šå†å²è¿‡æ»¤ (å®Œæ•´) ========= -->
    <div id="tool2-wrapper" class="tool-wrapper">
        <div class="tool2-container">
            <style>
                .tool2-container {
                    all: initial;
                    display: block;
                    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
                    background-color: #f8f9fa;
                    color: #333;
                    padding: 12px;
                    font-size: 14px;
                }
                .tool2-container * {
                    box-sizing: border-box;
                }
                .tool2-container .section {
                    background-color: white;
                    padding: 12px;
                    margin-bottom: 10px;
                    border-radius: 5px;
                    border: 1px solid #ddd;
                }
                .tool2-container .input-area {
                    width: 100%;
                    min-height: 100px;
                    padding: 8px;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    font-size: 0.85rem;
                    resize: vertical;
                    margin-bottom: 10px;
                    font-family: monospace;
                }
                .tool2-container .period-selector {
                    display: flex;
                    gap: 6px;
                    margin-bottom: 10px;
                }
                .tool2-container .period-option {
                    flex: 1;
                }
                .tool2-container .period-option input {
                    display: none;
                }
                .tool2-container .period-label {
                    display: block;
                    padding: 8px 2px;
                    background-color: #f0f0f0;
                    border-radius: 4px;
                    text-align: center;
                    cursor: pointer;
                    font-size: 0.8rem;
                    border: 1px solid #ccc;
                }
                .tool2-container .period-option input:checked + .period-label {
                    background-color: #7f8fa6;
                    color: white;
                    border-color: #7f8fa6;
                }
                .tool2-container .btn-row {
                    display: flex;
                    gap: 6px;
                    margin-bottom: 10px;
                }
                .tool2-container .btn {
                    flex: 1;
                    padding: 10px 6px;
                    border: none;
                    border-radius: 4px;
                    font-size: 0.8rem;
                    font-weight: 500;
                    cursor: pointer;
                    text-align: center;
                    white-space: nowrap;
                }
                .tool2-container .btn-primary {
                    background-color: #7f8fa6;
                    color: white;
                }
                .tool2-container .btn-secondary {
                    background-color: #f0f0f0;
                    color: #333;
                    border: 1px solid #ccc;
                }
                .tool2-container .btn-info {
                    background-color: #95a5a6;
                    color: white;
                }
                .tool2-container .stats {
                    display: flex;
                    justify-content: space-between;
                    background-color: #f8f9ff;
                    border-radius: 4px;
                    padding: 10px;
                    margin-bottom: 10px;
                    border: 1px solid #e0e0e0;
                }
                .tool2-container .stat-item {
                    text-align: center;
                }
                .tool2-container .stat-value {
                    font-size: 1.2rem;
                    font-weight: bold;
                    color: #7f8fa6;
                }
                .tool2-container .stat-label {
                    font-size: 0.75rem;
                    color: #666;
                }
                .tool2-container .action-buttons {
                    display: flex;
                    gap: 6px;
                    margin-bottom: 10px;
                }
                .tool2-container .action-buttons .btn {
                    font-size: 0.7rem;
                    padding: 6px 2px;
                }
                .tool2-container .numbers-container {
                    max-height: 250px;
                    overflow-y: auto;
                    border: 1px solid #e0e0e0;
                    border-radius: 4px;
                    padding: 8px;
                    margin-bottom: 10px;
                }
                .tool2-container .numbers-grid {
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 4px;
                }
                .tool2-container .number-item {
                    text-align: center;
                    padding: 6px 0;
                    background-color: white;
                    border: 1px solid #e0e0e0;
                    border-radius: 4px;
                    font-weight: 500;
                    font-size: 0.9rem;
                    cursor: pointer;
                    transition: background-color 0.1s;
                    user-select: none;
                }
                .tool2-container .number-item.selected {
                    background-color: #7f8fa6;
                    color: white;
                    border-color: #6b7b93;
                }
                .tool2-container .message-box {
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: #7f8fa6;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 5px;
                    z-index: 1000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    opacity: 0;
                    transition: opacity 0.3s;
                }
                .tool2-container .message-box.show {
                    opacity: 1;
                }
            </style>
            <div class="tool2-container">
                <div class="section">
                    <textarea class="input-area" id="filter_historyData" placeholder="ç²˜è´´å†å²å¼€å¥–å·ç ï¼Œæ ¼å¼ï¼š2024009 265ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰"></textarea>
                </div>
                <div class="section">
                    <div class="period-selector">
                        <div class="period-option">
                            <input type="radio" id="filter_period50" name="filter_period" value="50" checked>
                            <label class="period-label" for="filter_period50">50æœŸ</label>
                        </div>
                        <div class="period-option">
                            <input type="radio" id="filter_period150" name="filter_period" value="150">
                            <label class="period-label" for="filter_period150">150æœŸ</label>
                        </div>
                        <div class="period-option">
                            <input type="radio" id="filter_period300" name="filter_period" value="300">
                            <label class="period-label" for="filter_period300">300æœŸ</label>
                        </div>
                        <div class="period-option">
                            <input type="radio" id="filter_period500" name="filter_period" value="500">
                            <label class="period-label" for="filter_period500">500æœŸ</label>
                        </div>
                        <div class="period-option">
                            <input type="radio" id="filter_period1000" name="filter_period" value="1000">
                            <label class="period-label" for="filter_period1000">1000æœŸ</label>
                        </div>
                    </div>
                    
                    <div class="btn-row">
                        <button class="btn btn-primary" id="filter_calculateBtn">å¼€å§‹è®¡ç®—</button>
                        <button class="btn btn-secondary" id="filter_clearBtn">æ¸…ç©º</button>
                    </div>
                </div>
                <div class="section">
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="filter_remainingCount">1000</div>
                            <div class="stat-label">å‰©ä½™æ³¨æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="filter_selectedCount">0</div>
                            <div class="stat-label">å·²é€‰æ‹©</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="filter_totalPrice">0</div>
                            <div class="stat-label">é‡‘é¢(å…ƒ)</div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="filter_selectAllBtn">å…¨é€‰</button>
                        <button class="btn btn-secondary" id="filter_deselectAllBtn">å–æ¶ˆå…¨é€‰</button>
                        <button class="btn btn-secondary" id="filter_deleteSelectedBtn">åˆ é™¤æ‰€é€‰</button>
                        <button class="btn btn-secondary" id="filter_keepSelectedBtn">ä¿ç•™æ‰€é€‰</button>
                    </div>
                    
                    <div class="numbers-container">
                        <div class="numbers-grid" id="filter_numbersGrid"></div>
                    </div>
                    
                    <div class="btn-row">
                        <button class="btn btn-info" id="filter_copyAllBtn">å¤åˆ¶å…¨éƒ¨</button>
                        <button class="btn btn-info" id="filter_copySelectedBtn">å¤åˆ¶æ‰€é€‰</button>
                    </div>
                </div>
                <div style="text-align:center; padding:10px; color:#666; font-size:0.7rem;">ç†æ€§å‚è€ƒ</div>
            </div>
            <script>
                (function() {
                    let allNumbers = Array.from({length: 1000}, (_, i) => i.toString().padStart(3, '0'));
                    let currentNumbers = [...allNumbers];
                    let selectedNumbers = new Set();
                    
                    const historyDataEl = document.getElementById('filter_historyData');
                    const numbersGridEl = document.getElementById('filter_numbersGrid');
                    const remainingCountEl = document.getElementById('filter_remainingCount');
                    const selectedCountEl = document.getElementById('filter_selectedCount');
                    const totalPriceEl = document.getElementById('filter_totalPrice');
                    const messageBox = document.getElementById('filter_messageBox') || (() => {
                        const mb = document.createElement('div');
                        mb.className = 'message-box';
                        mb.id = 'filter_messageBox';
                        document.body.appendChild(mb);
                        return mb;
                    })();
                    
                    const sampleData = `2024009\t265
2024010\t437
2024011\t927
2024012\t590
2024013\t468
2024014\t251
2024015\t438
2024016\t920
2024017\t659
2024018\t347`;
                    
                    function showMessage(text) {
                        messageBox.textContent = text;
                        messageBox.classList.add('show');
                        setTimeout(() => messageBox.classList.remove('show'), 2000);
                    }
                    
                    function renderNumbers() {
                        numbersGridEl.innerHTML = '';
                        if (currentNumbers.length === 0) {
                            numbersGridEl.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:30px; color:#666;">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å·ç </div>';
                        } else {
                            currentNumbers.forEach(number => {
                                const isSelected = selectedNumbers.has(number);
                                const item = document.createElement('div');
                                item.className = 'number-item' + (isSelected ? ' selected' : '');
                                item.textContent = number;
                                item.dataset.number = number;
                                item.addEventListener('click', function(e) {
                                    const num = this.dataset.number;
                                    if (selectedNumbers.has(num)) {
                                        selectedNumbers.delete(num);
                                        this.classList.remove('selected');
                                    } else {
                                        selectedNumbers.add(num);
                                        this.classList.add('selected');
                                    }
                                    updateStats();
                                });
                                numbersGridEl.appendChild(item);
                            });
                        }
                        updateStats();
                    }
                    
                    function updateStats() {
                        remainingCountEl.textContent = currentNumbers.length;
                        selectedCountEl.textContent = selectedNumbers.size;
                        totalPriceEl.textContent = (selectedNumbers.size * 2).toFixed(0);
                    }
                    
                    function parseHistoryData() {
                        let data = historyDataEl.value.trim();
                        if (!data) return [];
                        const lines = data.split('\n');
                        const nums = [];
                        lines.forEach(line => {
                            const trimmed = line.trim();
                            if (!trimmed) return;
                            const parts = trimmed.split(/\s+/);
                            if (parts.length >= 2 && /^\d{3}$/.test(parts[1])) nums.push(parts[1]);
                            else {
                                const match = trimmed.match(/\d{3}/);
                                if (match) nums.push(match[0]);
                            }
                        });
                        return nums;
                    }
                    
                    function filterNumbers() {
                        const selectedPeriod = document.querySelector('input[name="filter_period"]:checked').value;
                        const period = parseInt(selectedPeriod);
                        let history = parseHistoryData();
                        let recent = [];
                        if (history.length === 0) {
                            const sampleLines = sampleData.split('\n');
                            sampleLines.forEach(l => { let p = l.split(/\s+/); if(p[1]) recent.push(p[1]); });
                            recent = recent.slice(-period);
                            showMessage(`ä½¿ç”¨ç¤ºä¾‹æ•°æ® (${recent.length}æœŸ)`);
                        } else {
                            recent = history.slice(-period);
                        }
                        currentNumbers = allNumbers.filter(n => !recent.includes(n));
                        selectedNumbers.clear();
                        renderNumbers();
                        showMessage(`è¿‡æ»¤å®Œæˆï¼Œå‰©ä½™${currentNumbers.length}æ³¨`);
                    }
                    
                    document.getElementById('filter_calculateBtn').addEventListener('click', filterNumbers);
                    document.getElementById('filter_clearBtn').addEventListener('click', function() {
                        historyDataEl.value = '';
                        currentNumbers = [...allNumbers];
                        selectedNumbers.clear();
                        renderNumbers();
                        showMessage('å·²é‡ç½®ä¸ºå…¨éƒ¨1000æ³¨');
                    });
                    document.getElementById('filter_selectAllBtn').addEventListener('click', function() {
                        currentNumbers.forEach(n => selectedNumbers.add(n));
                        renderNumbers();
                        showMessage(`å·²å…¨é€‰ ${selectedNumbers.size} æ³¨`);
                    });
                    document.getElementById('filter_deselectAllBtn').addEventListener('click', function() {
                        selectedNumbers.clear();
                        renderNumbers();
                        showMessage('å·²å–æ¶ˆå…¨é€‰');
                    });
                    document.getElementById('filter_deleteSelectedBtn').addEventListener('click', function() {
                        if (selectedNumbers.size === 0) return showMessage('è¯·å…ˆé€‰æ‹©å·ç ');
                        currentNumbers = currentNumbers.filter(n => !selectedNumbers.has(n));
                        selectedNumbers.clear();
                        renderNumbers();
                        showMessage('å·²åˆ é™¤æ‰€é€‰å·ç ');
                    });
                    document.getElementById('filter_keepSelectedBtn').addEventListener('click', function() {
                        if (selectedNumbers.size === 0) return showMessage('è¯·å…ˆé€‰æ‹©è¦ä¿ç•™çš„å·ç ');
                        currentNumbers = currentNumbers.filter(n => selectedNumbers.has(n));
                        selectedNumbers.clear();
                        renderNumbers();
                        showMessage('å·²ä¿ç•™æ‰€é€‰å·ç ');
                    });
                    
                    function generateCopyText(arr) {
                        if (!arr.length) return '';
                        let text = '';
                        arr.forEach((n,i) => { text += n; if ((i+1)%7===0) text += '\n'; else if (i<arr.length-1) text += ' '; });
                        return text;
                    }
                    
                    document.getElementById('filter_copyAllBtn').addEventListener('click', function() {
                        if (!currentNumbers.length) return showMessage('æ²¡æœ‰å·ç å¯å¤åˆ¶');
                        const text = generateCopyText(currentNumbers);
                        navigator.clipboard?.writeText(text).then(() => showMessage('å¤åˆ¶æˆåŠŸ')).catch(() => alert('æ‰‹åŠ¨å¤åˆ¶'));
                    });
                    document.getElementById('filter_copySelectedBtn').addEventListener('click', function() {
                        if (selectedNumbers.size === 0) return showMessage('æ²¡æœ‰é€‰ä¸­å·ç ');
                        const text = generateCopyText(Array.from(selectedNumbers));
                        navigator.clipboard?.writeText(text).then(() => showMessage('å¤åˆ¶æˆåŠŸ')).catch(() => alert('æ‰‹åŠ¨å¤åˆ¶'));
                    });
                    
                    renderNumbers();
                })();
            </script>
        </div>
    </div>

    <!-- ========= å·¥å…·3ï¼šåˆ†è§£ (å®Œæ•´) ========= -->
    <div id="tool3-wrapper" class="tool-wrapper">
        <div class="tool3-container">
            <style>
                .tool3-container {
                    all: initial;
                    display: block;
                    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
                    background-color: #ffffff;
                    color: #333;
                    padding: 16px 12px;
                    font-size: 14px;
                }
                .tool3-container * {
                    box-sizing: border-box;
                }
                .decompose-stack {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                    margin-bottom: 12px;
                }
                .decomp-card {
                    background: #f8fafc;
                    border-radius: 12px;
                    padding: 12px 12px;
                    border: 1px solid #e1e8ed;
                }
                .card-header {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    margin-bottom: 8px;
                }
                .card-header .label {
                    font-weight: 600;
                    font-size: 0.9rem;
                    color: #2c3e50;
                    background: transparent;
                    padding: 2px 8px;
                }
                .header-buttons {
                    display: flex;
                    gap: 6px;
                }
                .clear-btn, .remove-btn {
                    background: none;
                    border: none;
                    font-size: 1.1rem;
                    color: #7f8fa6;
                    cursor: pointer;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .clear-btn:active, .remove-btn:active {
                    background: #e1e8ed;
                }
                .decomp-input {
                    width: 100%;
                    background: #ffffff;
                    border: 1.5px solid #e1e8ed;
                    border-radius: 30px;
                    padding: 10px 14px;
                    font-size: 1rem;
                    font-family: inherit;
                    text-align: center;
                    color: #2c3e50;
                    outline: none;
                    margin-bottom: 10px;
                }
                .decomp-input:focus {
                    border-color: #7f8fa6;
                }
                .mode-row {
                    display: flex;
                    flex-wrap: wrap;
                    align-items: center;
                    gap: 6px 8px;
                    background: transparent;
                    border-radius: 24px;
                    padding: 4px 4px;
                    margin-bottom: 4px;
                    border: none;
                }
                .mode-label {
                    font-size: 0.8rem;
                    font-weight: 600;
                    color: #5a6e85;
                    min-width: 45px;
                }
                .mode-check-group {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px 12px;
                    align-items: center;
                }
                .mode-check-group label {
                    display: flex;
                    align-items: center;
                    gap: 3px;
                    background: #ffffff;
                    border: 1px solid #d9e2ef;
                    border-radius: 30px;
                    padding: 4px 12px;
                    font-size: 0.75rem;
                    color: #2c3e50;
                    white-space: nowrap;
                }
                .mode-check-group input {
                    accent-color: #7f8fa6;
                    width: 14px;
                    height: 14px;
                }
                .add-card-btn {
                    background: #ffffff;
                    border: 1px dashed #b8c9dd;
                    border-radius: 30px;
                    padding: 10px;
                    font-size: 0.95rem;
                    font-weight: 500;
                    color: #5a6e85;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 4px;
                    cursor: pointer;
                    margin-bottom: 14px;
                }
                .add-card-btn:active {
                    background: #f0f7fa;
                }
                .global-include {
                    background: #f8fafc;
                    border-radius: 30px;
                    padding: 8px 8px;
                    margin: 8px 0 12px;
                    display: flex;
                    flex-wrap: wrap;
                    align-items: center;
                    justify-content: space-between;
                    row-gap: 6px;
                    border: 1px solid #e1e8ed;
                }
                .global-include .title {
                    font-weight: 600;
                    color: #2c3e50;
                    font-size: 0.8rem;
                }
                .global-include .check-group {
                    display: flex;
                    gap: 8px;
                    flex-wrap: wrap;
                }
                .global-include label {
                    display: flex;
                    align-items: center;
                    gap: 3px;
                    background: #ffffff;
                    padding: 4px 12px;
                    border-radius: 30px;
                    border: 1px solid #d9e2ef;
                    color: #2c3e50;
                    font-size: 0.75rem;
                }
                .global-include input {
                    accent-color: #7f8fa6;
                    width: 14px;
                    height: 14px;
                }
                .generate-row {
                    display: flex;
                    gap: 6px;
                    margin: 8px 0 12px;
                }
                .gen-btn {
                    flex: 1;
                    background: #7f8fa6;
                    border: 1px solid #6b7b93;
                    border-radius: 30px;
                    padding: 10px 0;
                    font-size: 1rem;
                    font-weight: 600;
                    color: white;
                    text-align: center;
                    cursor: pointer;
                    box-shadow: 0 2px 0 #5a6e85;
                    transition: 0.05s linear;
                }
                .gen-btn:active {
                    transform: translateY(2px);
                    box-shadow: 0 1px 0 #5a6e85;
                }
                .result-header {
                    background: #f0f7fa;
                    border-radius: 28px;
                    padding: 8px 14px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    flex-wrap: wrap;
                    gap: 6px;
                    margin: 12px 0 8px;
                }
                .total-info {
                    font-size: 0.95rem;
                    color: #2c3e50;
                }
                .total-info strong {
                    background: #d9e2ef;
                    padding: 2px 8px;
                    border-radius: 30px;
                    margin: 0 3px;
                }
                .action-btns {
                    display: flex;
                    gap: 4px;
                }
                .action-btn {
                    background: #ffffff;
                    border: 1px solid #d9e2ef;
                    border-radius: 30px;
                    padding: 5px 14px;
                    font-size: 0.75rem;
                    font-weight: 520;
                    color: #2c3e50;
                    cursor: pointer;
                    box-shadow: 0 1px 0 #b0c4de;
                }
                .action-btn:active {
                    transform: translateY(1px);
                    box-shadow: none;
                }
                .numbers-grid {
                    background: #ffffff;
                    border-radius: 20px;
                    padding: 12px 6px;
                    max-height: 350px;
                    overflow-y: auto;
                    border: 1px solid #e1e8ed;
                }
                .grid-row {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 2px 2px;
                    margin-bottom: 4px;
                    justify-content: flex-start;
                }
                .number-item {
                    display: inline-flex;
                    align-items: center;
                    gap: 1px;
                    font-size: 0.75rem;
                    font-family: inherit;
                    color: #2c3e50;
                    padding: 2px 2px;
                    background: transparent;
                    border: none;
                    width: auto;
                    flex: 0 0 auto;
                }
                .number-item input {
                    width: 14px;
                    height: 14px;
                    accent-color: #7f8fa6;
                    margin: 0;
                }
                .placeholder {
                    color: #a0b8cc;
                    text-align: center;
                    padding: 16px 0;
                    font-style: italic;
                    font-size: 0.85rem;
                }
                .footer-note {
                    color: #7f8fa6;
                    font-size: 0.65rem;
                    text-align: center;
                    margin-top: 12px;
                    border-top: 1px dashed #d9e2ef;
                    padding-top: 8px;
                }
            </style>
            <div id="decomposeContainer" class="decompose-stack"></div>
            <div class="add-card-btn" id="addDecomposeBtn">
                <span style="font-size:1.3rem;">+</span> æ·»åŠ åˆ†è§£
            </div>
            <div class="global-include">
                <span class="title">åŒ…å«ç±»å‹</span>
                <div class="check-group">
                    <label><input type="checkbox" id="globalGroup3" checked> ç»„ä¸‰</label>
                    <label><input type="checkbox" id="globalGroup6" checked> ç»„å…­</label>
                    <label><input type="checkbox" id="globalBaozi" checked> è±¹å­</label>
                </div>
            </div>
            <div class="generate-row">
                <div class="gen-btn" id="genDirectBtn">ç›´é€‰</div>
                <div class="gen-btn" id="genGroupBtn">ç»„é€‰</div>
            </div>
            <div class="result-header">
                <div class="total-info" id="totalInfo">æ€» <strong>0</strong> æ³¨  <strong>0</strong>å…ƒ</div>
                <div class="action-btns">
                    <button class="action-btn" id="selectAllBtn">å…¨é€‰</button>
                    <button class="action-btn" id="copySelectedBtn">å¤åˆ¶</button>
                    <button class="action-btn" id="deleteSelectedBtn">åˆ é™¤</button>
                </div>
            </div>
            <div class="numbers-grid" id="numbersGrid">
                <div class="placeholder">ç‚¹å‡»ç›´é€‰æˆ–ç»„é€‰ç”Ÿæˆå·ç </div>
            </div>
            <div class="footer-note">ç‚¹å‡»å·ç å¯é€‰ä¸­ Â· å…¨é€‰/å¤åˆ¶/åˆ é™¤</div>
        </div>
        <script>
            (function() {
                let decomps = [
                    {
                        full: '01234-56789',
                        z6Left1Right2: true,
                        z6Right2Left1: true,
                        z3LeftSingleRightDup: true,
                        z3RightSingleLeftDup: true
                    }
                ];

                const globalGroup3 = document.getElementById('globalGroup3');
                const globalGroup6 = document.getElementById('globalGroup6');
                const globalBaozi = document.getElementById('globalBaozi');

                let currentNumbers = [];
                let currentMode = 'direct';

                const container = document.getElementById('decomposeContainer');
                const addBtn = document.getElementById('addDecomposeBtn');
                const genDirect = document.getElementById('genDirectBtn');
                const genGroup = document.getElementById('genGroupBtn');
                const totalInfo = document.getElementById('totalInfo');
                const numbersGrid = document.getElementById('numbersGrid');
                const copyBtn = document.getElementById('copySelectedBtn');
                const deleteBtn = document.getElementById('deleteSelectedBtn');
                const selectAllBtn = document.getElementById('selectAllBtn');

                function renderDecomposes() {
                    container.innerHTML = '';
                    decomps.forEach((decomp, index) => {
                        const card = document.createElement('div');
                        card.className = 'decomp-card';

                        const header = document.createElement('div');
                        header.className = 'card-header';
                        const label = document.createElement('span');
                        label.className = 'label';
                        label.textContent = `åˆ†è§£${index+1}`;

                        const btnGroup = document.createElement('div');
                        btnGroup.className = 'header-buttons';

                        const clearBtn = document.createElement('button');
                        clearBtn.className = 'clear-btn';
                        clearBtn.innerHTML = 'ğŸ—‘ï¸';
                        clearBtn.title = 'æ¸…ç©ºåˆ†è§£å¼';
                        clearBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            decomp.full = '';
                            const input = card.querySelector('.decomp-input');
                            if (input) input.value = '';
                        });

                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = 'âœ•';
                        removeBtn.title = 'åˆ é™¤åˆ†è§£';
                        removeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            if (decomps.length > 1) {
                                decomps.splice(index, 1);
                                renderDecomposes();
                            } else {
                                alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªåˆ†è§£');
                            }
                        });

                        btnGroup.appendChild(clearBtn);
                        btnGroup.appendChild(removeBtn);
                        header.appendChild(label);
                        header.appendChild(btnGroup);
                        card.appendChild(header);

                        const input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'decomp-input';
                        input.value = decomp.full || '';
                        input.placeholder = '01234-56789';
                        input.addEventListener('input', (e) => {
                            decomp.full = e.target.value;
                        });
                        card.appendChild(input);

                        const z6Row = document.createElement('div');
                        z6Row.className = 'mode-row';
                        z6Row.innerHTML = `<span class="mode-label">ç»„å…­</span>`;
                        const z6Checks = document.createElement('div');
                        z6Checks.className = 'mode-check-group';

                        const cb1 = document.createElement('label');
                        cb1.innerHTML = '<input type="checkbox"> å·¦1å³2';
                        const chk1 = cb1.querySelector('input');
                        chk1.checked = decomp.z6Left1Right2;
                        chk1.addEventListener('change', (e) => { decomp.z6Left1Right2 = e.target.checked; });

                        const cb2 = document.createElement('label');
                        cb2.innerHTML = '<input type="checkbox"> å³2å·¦1';
                        const chk2 = cb2.querySelector('input');
                        chk2.checked = decomp.z6Right2Left1;
                        chk2.addEventListener('change', (e) => { decomp.z6Right2Left1 = e.target.checked; });

                        z6Checks.appendChild(cb1);
                        z6Checks.appendChild(cb2);
                        z6Row.appendChild(z6Checks);
                        card.appendChild(z6Row);

                        const z3Row = document.createElement('div');
                        z3Row.className = 'mode-row';
                        z3Row.innerHTML = `<span class="mode-label">ç»„ä¸‰</span>`;
                        const z3Checks = document.createElement('div');
                        z3Checks.className = 'mode-check-group';

                        const cb3 = document.createElement('label');
                        cb3.innerHTML = '<input type="checkbox"> å·¦å•å³é‡';
                        const chk3 = cb3.querySelector('input');
                        chk3.checked = decomp.z3LeftSingleRightDup;
                        chk3.addEventListener('change', (e) => { decomp.z3LeftSingleRightDup = e.target.checked; });

                        const cb4 = document.createElement('label');
                        cb4.innerHTML = '<input type="checkbox"> å³å•å·¦é‡';
                        const chk4 = cb4.querySelector('input');
                        chk4.checked = decomp.z3RightSingleLeftDup;
                        chk4.addEventListener('change', (e) => { decomp.z3RightSingleLeftDup = e.target.checked; });

                        z3Checks.appendChild(cb3);
                        z3Checks.appendChild(cb4);
                        z3Row.appendChild(z3Checks);
                        card.appendChild(z3Row);

                        container.appendChild(card);
                    });
                }

                function parseFullString(str) {
                    const parts = str.split('-');
                    if (parts.length !== 2) return null;
                    const leftStr = parts[0].replace(/[^0-9]/g, '');
                    const rightStr = parts[1].replace(/[^0-9]/g, '');
                    const leftSet = new Set(leftStr.split('').map(Number));
                    const rightSet = new Set(rightStr.split('').map(Number));
                    if (leftSet.size === 0 && rightSet.size === 0) return null;
                    return { left: leftSet, right: rightSet };
                }

                function getNumberType(numStr) {
                    const arr = numStr.split('').map(Number);
                    if (arr[0] === arr[1] && arr[1] === arr[2]) return 'baozi';
                    if (arr[0] === arr[1] || arr[1] === arr[2] || arr[0] === arr[2]) return 'group3';
                    return 'group6';
                }

                function passesAllDecomposes(numStr) {
                    const type = getNumberType(numStr);
                    for (let i = 0; i < decomps.length; i++) {
                        const d = decomps[i];
                        const parsed = parseFullString(d.full);
                        if (!parsed) continue;
                        const { left, right } = parsed;
                        const digits = numStr.split('').map(Number);
                        for (let digit of digits) {
                            if (!left.has(digit) && !right.has(digit)) return false;
                        }
                        if (type === 'group6') {
                            const leftCount = digits.filter(x => left.has(x)).length;
                            const rightCount = 3 - leftCount;
                            if (leftCount === 1 && rightCount === 2) {
                                if (!d.z6Left1Right2) return false;
                            } else if (leftCount === 2 && rightCount === 1) {
                                if (!d.z6Right2Left1) return false;
                            } else return false;
                        } else if (type === 'group3') {
                            const cnt = {};
                            digits.forEach(v => cnt[v] = (cnt[v]||0)+1);
                            let dupe = null, single = null;
                            for (let [k, v] of Object.entries(cnt)) {
                                if (v === 2) dupe = Number(k);
                                else if (v === 1) single = Number(k);
                            }
                            if (!dupe || !single) return false;
                            const singleLeft = left.has(single);
                            const singleRight = right.has(single);
                            const dupeLeft = left.has(dupe);
                            const dupeRight = right.has(dupe);
                            if (singleLeft && dupeRight) {
                                if (!d.z3LeftSingleRightDup) return false;
                            } else if (singleRight && dupeLeft) {
                                if (!d.z3RightSingleLeftDup) return false;
                            } else return false;
                        } else if (type === 'baozi') {
                            const d0 = digits[0];
                            if (left.has(d0) && !right.has(d0)) continue;
                            if (right.has(d0) && !left.has(d0)) continue;
                            return false;
                        }
                    }
                    return true;
                }

                function generateDirect() {
                    const results = [];
                    for (let i = 0; i <= 999; i++) {
                        const numStr = i.toString().padStart(3, '0');
                        const type = getNumberType(numStr);
                        if (type === 'baozi' && !globalBaozi.checked) continue;
                        if (type === 'group3' && !globalGroup3.checked) continue;
                        if (type === 'group6' && !globalGroup6.checked) continue;
                        if (passesAllDecomposes(numStr)) results.push(numStr);
                    }
                    return results;
                }

                function generateGroup() {
                    const results = [];
                    if (globalGroup6.checked) {
                        for (let a = 0; a <= 9; a++) {
                            for (let b = a+1; b <= 9; b++) {
                                for (let c = b+1; c <= 9; c++) {
                                    const numStr = `${a}${b}${c}`;
                                    if (passesAllDecomposes(numStr)) results.push(numStr);
                                }
                            }
                        }
                    }
                    if (globalGroup3.checked) {
                        for (let dupe = 0; dupe <= 9; dupe++) {
                            for (let single = 0; single <= 9; single++) {
                                if (dupe === single) continue;
                                const numStr = `${dupe}${dupe}${single}`;
                                if (passesAllDecomposes(numStr)) results.push(numStr);
                            }
                        }
                    }
                    if (globalBaozi.checked) {
                        for (let d = 0; d <= 9; d++) {
                            const numStr = `${d}${d}${d}`;
                            if (passesAllDecomposes(numStr)) results.push(numStr);
                        }
                    }
                    return [...new Set(results)];
                }

                function displayNumbers(numbers) {
                    numbersGrid.innerHTML = '';
                    if (!numbers.length) {
                        numbersGrid.innerHTML = '<div class="placeholder">æ— åŒ¹é…å·ç </div>';
                        totalInfo.innerHTML = `æ€» <strong>0</strong> æ³¨  <strong>0</strong>å…ƒ`;
                        return;
                    }
                    for (let i = 0; i < numbers.length; i += 7) {
                        const row = document.createElement('div');
                        row.className = 'grid-row';
                        const chunk = numbers.slice(i, i+7);
                        chunk.forEach(num => {
                            const item = document.createElement('span');
                            item.className = 'number-item';
                            const cb = document.createElement('input');
                            cb.type = 'checkbox';
                            cb.value = num;
                            item.appendChild(cb);
                            item.appendChild(document.createTextNode(num));
                            row.appendChild(item);
                        });
                        numbersGrid.appendChild(row);
                    }
                    totalInfo.innerHTML = `æ€» <strong>${numbers.length}</strong> æ³¨  <strong>${numbers.length*2}</strong>å…ƒ`;
                }

                function toggleSelectAll() {
                    const checkboxes = document.querySelectorAll('#numbersGrid .number-item input[type="checkbox"]');
                    if (!checkboxes.length) return;
                    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                    checkboxes.forEach(cb => cb.checked = !allChecked);
                }

                function copySelected() {
                    const checked = document.querySelectorAll('#numbersGrid .number-item input[type="checkbox"]:checked');
                    if (!checked.length) return alert('è¯·å…ˆé€‰ä¸­å·ç ');
                    const text = Array.from(checked).map(cb => cb.value).join(' ');
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(text).then(() => {
                            alert(`å·²å¤åˆ¶ ${checked.length} æ³¨`);
                        }).catch(() => fallbackCopy(text));
                    } else {
                        fallbackCopy(text);
                    }
                }

                function fallbackCopy(text) {
                    const ta = document.createElement('textarea');
                    ta.value = text;
                    ta.style.position = 'fixed';
                    ta.style.opacity = '0';
                    document.body.appendChild(ta);
                    ta.select();
                    try {
                        document.execCommand('copy');
                        alert(`å·²å¤åˆ¶ ${text.split(' ').length} æ³¨`);
                    } catch {
                        prompt('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', text);
                    } finally {
                        document.body.removeChild(ta);
                    }
                }

                function generate(mode) {
                    currentMode = mode;
                    const numbers = mode === 'direct' ? generateDirect() : generateGroup();
                    currentNumbers = numbers;
                    displayNumbers(numbers);
                }

                genDirect.addEventListener('click', () => generate('direct'));
                genGroup.addEventListener('click', () => generate('group'));
                selectAllBtn.addEventListener('click', toggleSelectAll);
                copyBtn.addEventListener('click', copySelected);
                deleteBtn.addEventListener('click', () => {
                    const checked = document.querySelectorAll('#numbersGrid .number-item input[type="checkbox"]:checked');
                    if (!checked.length) return alert('è¯·å…ˆé€‰ä¸­è¦åˆ é™¤çš„å·ç ');
                    const toDelete = new Set(Array.from(checked).map(cb => cb.value));
                    currentNumbers = currentNumbers.filter(n => !toDelete.has(n));
                    displayNumbers(currentNumbers);
                });

                addBtn.addEventListener('click', () => {
                    decomps.push({
                        full: '',
                        z6Left1Right2: true,
                        z6Right2Left1: true,
                        z3LeftSingleRightDup: true,
                        z3RightSingleLeftDup: true
                    });
                    renderDecomposes();
                });

                renderDecomposes();
            })();
        </script>
    </div>

    <!-- å¯¼èˆªåˆ‡æ¢è„šæœ¬ (æ”¯æŒä¸‰ä¸ªå·¥å…·) -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const btn1 = document.getElementById('btnTool1');
            const btn2 = document.getElementById('btnTool2');
            const btn3 = document.getElementById('btnTool3');
            const wrapper1 = document.getElementById('tool1-wrapper');
            const wrapper2 = document.getElementById('tool2-wrapper');
            const wrapper3 = document.getElementById('tool3-wrapper');

            function switchTool(active) {
                btn1.classList.toggle('active', active === 1);
                btn2.classList.toggle('active', active === 2);
                btn3.classList.toggle('active', active === 3);
                wrapper1.classList.toggle('active', active === 1);
                wrapper2.classList.toggle('active', active === 2);
                wrapper3.classList.toggle('active', active === 3);
            }

            btn1.addEventListener('click', () => switchTool(1));
            btn2.addEventListener('click', () => switchTool(2));
            btn3.addEventListener('click', () => switchTool(3));
        });
    </script>

    <!-- Font Awesome å›¾æ ‡åº“ (ä¾›å·¥å…·1ä½¿ç”¨) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>
