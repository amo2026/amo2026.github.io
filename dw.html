<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D选码计算神器 · 优化版</title>
    <style>
        /* 样式完全保留原版，未作改动 */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; }
        body { background-color: #f0f2f5; color: #333; line-height: 1.2; padding: 4px; min-height: 100vh; font-size: 11px; }
        .container { max-width: 100%; background-color: white; overflow: hidden; margin-bottom: 6px; }
        .header { background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%); color: white; padding: 8px; text-align: center; }
        .header h1 { font-size: 16px; margin-bottom: 2px; font-weight: 600; }
        .header p { opacity: 0.9; font-size: 10px; }
        .section { padding: 8px; border-bottom: 1px solid #eaeaea; }
        .section-title { font-size: 12px; font-weight: 600; color: #1a73e8; margin-bottom: 6px; display: flex; align-items: center; }
        .section-title:before { content: ""; display: inline-block; width: 3px; height: 10px; background-color: #1a73e8; margin-right: 6px; }
        .selection-type { display: flex; margin-bottom: 8px; }
        .radio-group { display: flex; width: 100%; justify-content: space-between; gap: 4px; }
        .radio-option { flex: 1; display: flex; align-items: center; justify-content: center; padding: 3px 0; border: 1px solid #d1d9e6; border-radius: 4px; background-color: #f8f9fa; cursor: pointer; }
        .radio-option input { display: none; }
        .radio-option label { cursor: pointer; font-size: 10px; letter-spacing: 0.2px; }
        .radio-option input:checked + label { color: #1a73e8; font-weight: 600; }
        .radio-option.active { background-color: #e8f0fe; border-color: #1a73e8; }
        .position-selection { display: flex; flex-direction: column; gap: 8px; margin-bottom: 8px; }
        .position-box { background-color: #f9fafc; padding: 8px; border: 1px solid #e1e5eb; border-radius: 4px; }
        .position-title { font-weight: 600; margin-bottom: 6px; font-size: 11px; color: #1a73e8; text-align: center; }
        .number-row { display: flex; flex-wrap: nowrap; justify-content: space-between; gap: 2px; margin-bottom: 6px; }
        .number-checkbox { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .number-checkbox input { display: none; }
        .number-checkbox label { display: flex; align-items: center; justify-content: center; width: 100%; min-width: 22px; height: 22px; background-color: white; border: 1px solid #d1d9e6; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 10px; border-radius: 2px; }
        .number-checkbox input:checked + label { background-color: #1a73e8; color: white; border-color: #1a73e8; }
        .quick-select { display: flex; justify-content: space-between; gap: 4px; }
        .quick-btn { flex: 1; padding: 4px 0; border: 1px solid #d1d9e6; background-color: white; cursor: pointer; font-size: 10px; transition: all 0.2s ease; border-radius: 2px; letter-spacing: 0.2px; }
        .quick-btn:hover, .quick-btn:active { background-color: #f0f3f9; }
        .non-positioned-selection { display: none; }
        .custom-selection { display: none; }
        .condition-options { display: flex; flex-direction: column; gap: 8px; }
        .option-group { margin-bottom: 3px; }
        .option-group-title { font-weight: 600; margin-bottom: 6px; color: #444; font-size: 11px; }
        .radio-group-type { display: flex; width: 100%; justify-content: space-between; gap: 4px; }
        .radio-option-type { flex: 1; display: flex; align-items: center; justify-content: center; padding: 5px 0; border: 1px solid #d1d9e6; border-radius: 4px; background-color: #f8f9fa; cursor: pointer; }
        .radio-option-type input { display: none; }
        .radio-option-type label { cursor: pointer; font-size: 11px; letter-spacing: 0.2px; }
        .radio-option-type input:checked + label { color: white; font-weight: 600; }
        .radio-option-type.active { background-color: #1a73e8; color: white; border-color: #1a73e8; }
        .checkbox-options { display: flex; flex-wrap: wrap; gap: 8px; }
        .checkbox-option { display: flex; align-items: center; }
        .checkbox-option input { margin-right: 3px; }
        .analyze-btn-container { text-align: center; margin: 12px 0 8px 0; }
        .analyze-btn { background-color: #1a73e8; color: white; border: none; padding: 8px 16px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(26, 115, 232, 0.2); width: 100%; max-width: 200px; border-radius: 4px; letter-spacing: 0.3px; }
        .analyze-btn:hover, .analyze-btn:active { background-color: #0d62d9; }
        .result-section { background-color: #f0f7ff; padding: 10px; border: 1px solid #cce0ff; border-radius: 4px; }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; flex-wrap: wrap; }
        .result-title { font-weight: 600; font-size: 11px; color: #1a73e8; }
        .result-count { font-weight: 600; font-size: 12px; color: #e74c3c; }
        .filter-section { background-color: white; padding: 8px; margin-bottom: 10px; border: 1px solid #e1e5eb; border-radius: 4px; }
        .filter-group { margin-bottom: 8px; border: 1px solid #e1e5eb; border-radius: 4px; overflow: hidden; }
        .filter-header { display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background-color: #f8f9fa; cursor: pointer; border-bottom: 1px solid #e1e5eb; }
        .filter-title { font-weight: 600; color: #444; font-size: 11px; }
        .filter-toggle { font-size: 11px; transition: transform 0.3s ease; }
        .filter-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .filter-content.expanded { max-height: 500px; padding: 8px; }
        .filter-subtitle { font-weight: 600; margin-bottom: 6px; color: #555; font-size: 10px; }
        .filter-numbers { display: flex; flex-wrap: nowrap; justify-content: space-between; gap: 2px; margin-bottom: 8px; }
        .filter-number { display: flex; align-items: center; justify-content: center; flex: 1; min-width: 20px; height: 20px; background-color: white; border: 1px solid #d1d9e6; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 10px; border-radius: 2px; }
        .filter-number.active { background-color: #1a73e8; color: white; border-color: #1a73e8; }
        .filter-number.kill.active { background-color: #e74c3c; color: white; border-color: #e74c3c; }
        .filter-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-bottom: 8px; }
        .filter-option { display: flex; align-items: center; justify-content: center; height: 20px; background-color: white; border: 1px solid #d1d9e6; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 10px; border-radius: 2px; }
        .filter-option.active { background-color: #1a73e8; color: white; border-color: #1a73e8; }
        .filter-option.kill.active { background-color: #e74c3c; color: white; border-color: #e74c3c; }
        .pattern-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; margin-bottom: 8px; }
        .pattern-option { display: flex; align-items: center; justify-content: center; height: 22px; background-color: white; border: 1px solid #d1d9e6; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 10px; border-radius: 2px; }
        .pattern-option.active { background-color: #1a73e8; color: white; border-color: #1a73e8; }
        .pattern-option.kill.active { background-color: #e74c3c; color: white; border-color: #e74c3c; }
        .filter-buttons { display: flex; gap: 4px; margin-top: 10px; }
        .filter-btn { flex: 1; padding: 8px 0; border: 1px solid #d1d9e6; background-color: white; cursor: pointer; font-size: 10px; transition: all 0.2s ease; border-radius: 4px; letter-spacing: 0.2px; font-weight: 600; }
        .filter-btn.apply { background-color: #1a73e8; color: white; border-color: #1a73e8; }
        .filter-btn.clear { background-color: #f8f9fa; color: #333; }
        .action-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 8px; }
        .action-buttons-row2 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 8px; }
        .btn { padding: 8px 0; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s ease; font-size: 10px; display: flex; align-items: center; justify-content: center; border-radius: 4px; letter-spacing: 0.2px; }
        .btn-select-all { background-color: #f8f9fa; color: #1a73e8; border: 1px solid #d1d9e6; }
        .btn-cancel { background-color: #f8f9fa; color: #666; border: 1px solid #d1d9e6; }
        .btn-keep { background-color: #f8f9fa; color: #34a853; border: 1px solid #d1d9e6; }
        .btn-delete { background-color: #f8f9fa; color: #e74c3c; border: 1px solid #dee2e6; }
        .btn-copy { background-color: #f8f9fa; color: #333; border: 1px solid #dee2e6; }
        .btn-export { background-color: #f8f9fa; color: #333; border: 1px solid #dee2e6; }
        .btn-reset { background-color: #1a73e8; color: white; border: 1px solid #1a73e8; padding: 10px 0; font-size: 12px; font-weight: 600; width: 100%; margin-top: 4px; border-radius: 4px; }
        .result-list-container { max-height: 180px; overflow-y: auto; border: 1px solid #e1e5eb; background-color: white; padding: 6px; margin-bottom: 8px; border-radius: 4px; }
        .result-list { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .number-item { display: flex; align-items: center; padding: 3px; background-color: white; border: 1px solid #e1e5eb; justify-content: center; font-size: 10px; border-radius: 2px; }
        .number-item input { margin-right: 3px; }
        .number-item span { font-weight: 600; letter-spacing: 0.5px; }
        .empty-result { text-align: center; color: #888; padding: 20px 10px; grid-column: 1/-1; }
        .footer { text-align: center; padding: 8px; color: #777; font-size: 9px; border-top: 1px solid #eaeaea; background-color: #f9fafc; }
        .highlight { color: #e74c3c; font-weight: 600; }
        .note { margin-top: 8px; padding: 8px; background-color: #fff8e1; border-left: 2px solid #ffc107; font-size: 10px; color: #666; border-radius: 4px; }
        .note ul { margin-top: 3px; margin-left: 12px; }
        .note li { margin-bottom: 1px; }
        .contact { color: #1a73e8; font-weight: 600; }
        .error-message { background-color: #ffeaea; color: #e74c3c; border: 1px solid #ffcdd2; padding: 6px; margin-bottom: 8px; text-align: center; font-size: 10px; display: none; border-radius: 4px; }
        .custom-textarea { width: 100%; height: 80px; padding: 6px; border: 1px solid #d1d9e6; font-size: 10px; resize: none; border-radius: 4px; margin-bottom: 6px; }
        .custom-note { font-size: 9px; color: #888; margin-bottom: 6px; font-style: italic; }
        .hidden-section { display: none; }
        .btn:active { transform: scale(0.98); }
        .custom-analyze-btn { background-color: #1a73e8; color: white; border: none; padding: 8px 0; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(26, 115, 232, 0.2); width: 100%; border-radius: 4px; letter-spacing: 0.3px; }
        .custom-analyze-btn:hover, .custom-analyze-btn:active { background-color: #0d62d9; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>3D选码计算神器</h1>
            <p>选择您的复试号码，筛选缩水，计算注数和金额</p>
        </div>
        
        <div class="section">
            <div class="section-title">号码选项</div>
            
            <div class="selection-type">
                <div class="radio-group">
                    <div class="radio-option" id="positionedOption">
                        <input type="radio" id="positioned" name="selectionType" value="positioned">
                        <label for="positioned">定位选号</label>
                    </div>
                    <div class="radio-option active" id="nonPositionedOption">
                        <input type="radio" id="non-positioned" name="selectionType" value="non-positioned" checked>
                        <label for="non-positioned">不定位选号</label>
                    </div>
                    <div class="radio-option" id="customOption">
                        <input type="radio" id="custom" name="selectionType" value="custom">
                        <label for="custom">自定义选号</label>
                    </div>
                </div>
            </div>
            
            <p style="margin-bottom: 8px; color: #666; font-size: 10px;">点击号码小框选择您的复式号码：</p>
            
            <!-- 定位选号区域 -->
            <div class="position-selection" id="positionedSelection">
                <div class="position-box">
                    <div class="position-title">百位</div>
                    <div class="number-row" id="hundreds"></div>
                    <div class="quick-select">
                        <button type="button" class="quick-btn" data-position="hundreds" data-type="odd">单</button>
                        <button type="button" class="quick-btn" data-position="hundreds" data-type="even">双</button>
                        <button type="button" class="quick-btn" data-position="hundreds" data-type="all">全</button>
                    </div>
                </div>
                <div class="position-box">
                    <div class="position-title">十位</div>
                    <div class="number-row" id="tens"></div>
                    <div class="quick-select">
                        <button type="button" class="quick-btn" data-position="tens" data-type="odd">单</button>
                        <button type="button" class="quick-btn" data-position="tens" data-type="even">双</button>
                        <button type="button" class="quick-btn" data-position="tens" data-type="all">全</button>
                    </div>
                </div>
                <div class="position-box">
                    <div class="position-title">个位</div>
                    <div class="number-row" id="units"></div>
                    <div class="quick-select">
                        <button type="button" class="quick-btn" data-position="units" data-type="odd">单</button>
                        <button type="button" class="quick-btn" data-position="units" data-type="even">双</button>
                        <button type="button" class="quick-btn" data-position="units" data-type="all">全</button>
                    </div>
                </div>
            </div>
            
            <!-- 不定位选号区域 -->
            <div class="non-positioned-selection" id="nonPositionedSelection">
                <div class="position-box">
                    <div class="position-title">不定位选号</div>
                    <div class="number-row" id="nonPositionedNumbers"></div>
                    <div class="quick-select">
                        <button type="button" class="quick-btn" data-position="nonPositioned" data-type="odd">单</button>
                        <button type="button" class="quick-btn" data-position="nonPositioned" data-type="even">双</button>
                        <button type="button" class="quick-btn" data-position="nonPositioned" data-type="all">全</button>
                    </div>
                </div>
            </div>
            
            <!-- 自定义选号区域 -->
            <div class="custom-selection" id="customSelection">
                <div class="position-box">
                    <div class="position-title">自定义选号</div>
                    <textarea class="custom-textarea" id="customNumbers" placeholder="请输入或粘贴号码（用空格或逗号分开）&#10;例如：123 456 789 012 345 678 901 234 567 890&#10;提示：粘贴后会自动整理为每行5个号码显示"></textarea>
                    <div class="custom-note">提示：输入或粘贴号码后会自动整理为每行5个号码显示</div>
                    <button type="button" class="custom-analyze-btn" id="processCustomBtn">开始分析</button>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <!-- 条件选项区域（定位和不定位选号显示） -->
        <div class="section" id="conditionSection">
            <div class="section-title">条件选项</div>
            <div class="condition-options">
                <div class="option-group">
                    <div class="option-group-title">生成类型</div>
                    <div class="radio-group-type">
                        <div class="radio-option-type active" id="straightOption">
                            <input type="radio" id="straight" name="generateType" value="straight" checked>
                            <label for="straight">生成所有直选</label>
                        </div>
                        <div class="radio-option-type" id="groupOption">
                            <input type="radio" id="group" name="generateType" value="group">
                            <label for="group">生成所有组选</label>
                        </div>
                    </div>
                </div>
                <div class="option-group">
                    <div class="option-group-title">包含类型（直选/组选模式都有效）</div>
                    <div class="checkbox-options">
                        <div class="checkbox-option">
                            <input type="checkbox" id="group3" name="includeTypes" value="group3" checked>
                            <label for="group3">包含组三</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="group6" name="includeTypes" value="group6" checked>
                            <label for="group6">包含组六</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="leopard" name="includeTypes" value="leopard" checked>
                            <label for="leopard">包含豹子</label>
                        </div>
                    </div>
                    <p style="font-size: 9px; color: #888; margin-top: 4px;">说明：若不选则为包含全部</p>
                </div>
            </div>
            <div class="analyze-btn-container">
                <button type="button" class="analyze-btn" id="analyzeBtn">开始分析</button>
            </div>
        </div>
        
        <!-- 筛选功能区域 -->
        <div class="section" id="filterSection">
            <div class="section-title">筛选缩水功能</div>
            <div class="filter-section">
                <!-- 胆码选杀 -->
                <div class="filter-group">
                    <div class="filter-header" data-target="danmaFilter">
                        <div class="filter-title">胆码选杀</div>
                        <div class="filter-toggle">+</div>
                    </div>
                    <div class="filter-content" id="danmaFilter">
                        <div style="margin-bottom: 6px;">
                            <div class="filter-subtitle">选码（可多选，包含任意一个选码即保留）</div>
                            <div class="filter-numbers" id="selectNumbers"></div>
                        </div>
                        <div>
                            <div class="filter-subtitle">杀码（可多选，不包含所有杀码即保留）</div>
                            <div class="filter-numbers" id="killNumbers"></div>
                        </div>
                    </div>
                </div>
                <!-- 和值选杀 -->
                <div class="filter-group">
                    <div class="filter-header" data-target="hezhiFilter">
                        <div class="filter-title">和值选杀</div>
                        <div class="filter-toggle">+</div>
                    </div>
                    <div class="filter-content" id="hezhiFilter">
                        <div style="margin-bottom: 6px;">
                            <div class="filter-subtitle">选和值（可多选）</div>
                            <div class="filter-grid" id="selectSumValues"></div>
                        </div>
                        <div>
                            <div class="filter-subtitle">杀和值（可多选）</div>
                            <div class="filter-grid" id="killSumValues"></div>
                        </div>
                    </div>
                </div>
                <!-- 和尾选杀 -->
                <div class="filter-group">
                    <div class="filter-header" data-target="heweiFilter">
                        <div class="filter-title">和尾选杀</div>
                        <div class="filter-toggle">+</div>
                    </div>
                    <div class="filter-content" id="heweiFilter">
                        <div style="margin-bottom: 6px;">
                            <div class="filter-subtitle">选和尾（可多选）</div>
                            <div class="filter-numbers" id="selectTailValues"></div>
                        </div>
                        <div>
                            <div class="filter-subtitle">杀和尾（可多选）</div>
                            <div class="filter-numbers" id="killTailValues"></div>
                        </div>
                    </div>
                </div>
                <!-- 跨度选杀 -->
                <div class="filter-group">
                    <div class="filter-header" data-target="kuaduFilter">
                        <div class="filter-title">跨度选杀</div>
                        <div class="filter-toggle">+</div>
                    </div>
                    <div class="filter-content" id="kuaduFilter">
                        <div style="margin-bottom: 6px;">
                            <div class="filter-subtitle">选跨（可多选）</div>
                            <div class="filter-numbers" id="selectSpanValues"></div>
                        </div>
                        <div>
                            <div class="filter-subtitle">杀跨（可多选）</div>
                            <div class="filter-numbers" id="killSpanValues"></div>
                        </div>
                    </div>
                </div>
                <!-- 奇偶选杀 -->
                <div class="filter-group">
                    <div class="filter-header" data-target="jiouFilter">
                        <div class="filter-title">奇偶选杀</div>
                        <div class="filter-toggle">+</div>
                    </div>
                    <div class="filter-content" id="jiouFilter">
                        <div style="margin-bottom: 6px;">
                            <div class="filter-subtitle">选奇偶（可多选）</div>
                            <div class="pattern-grid" id="selectOddEvenPatterns"></div>
                        </div>
                        <div>
                            <div class="filter-subtitle">杀奇偶（可多选）</div>
                            <div class="pattern-grid" id="killOddEvenPatterns"></div>
                        </div>
                    </div>
                </div>
                <!-- 大小选杀 -->
                <div class="filter-group">
                    <div class="filter-header" data-target="daxiaoFilter">
                        <div class="filter-title">大小选杀</div>
                        <div class="filter-toggle">+</div>
                    </div>
                    <div class="filter-content" id="daxiaoFilter">
                        <div style="margin-bottom: 6px;">
                            <div class="filter-subtitle">选大小（可多选）</div>
                            <div class="pattern-grid" id="selectSizePatterns"></div>
                        </div>
                        <div>
                            <div class="filter-subtitle">杀大小（可多选）</div>
                            <div class="pattern-grid" id="killSizePatterns"></div>
                        </div>
                    </div>
                </div>
                <div class="filter-buttons">
                    <button type="button" class="filter-btn apply" id="applyFilter">筛选</button>
                    <button type="button" class="filter-btn clear" id="clearFilter">清除筛选</button>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">计算结果</div>
            <div class="result-section">
                <div class="result-header">
                    <div class="result-title">总共查出<span id="count">0</span>注选号，共计<span id="amount">0</span>元</div>
                    <div class="result-count" id="resultCount">0注/0元</div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-select-all" id="selectAllBtn">✓全选结果</button>
                    <button type="button" class="btn btn-cancel" id="cancelSelected">✗取消所选</button>
                    <button type="button" class="btn btn-keep" id="keepSelected">✓保留所选</button>
                </div>
                <div class="action-buttons-row2">
                    <button type="button" class="btn btn-delete" id="deleteSelected">×删除所选</button>
                    <button type="button" class="btn btn-copy" id="copySelectedBtn">⎘复制所选</button>
                    <button type="button" class="btn btn-export" id="exportText">↓导出文本</button>
                </div>
                <button type="button" class="btn btn-reset" id="resetBtn">↺重置条件</button>
                <div class="result-list-container">
                    <div class="result-list" id="resultList">
                        <div class="empty-result">请选择号码并点击"开始分析"以查看结果</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="note">
            <strong>使用说明：</strong> 
            <ul>
                <li><strong>定位选号</strong>：分别选择百位、十位、个位的号码，生成所有可能的直选组合（必须百位、十位、个位都至少选择一个数字）</li>
                <li><strong>不定位选号</strong>：只需从0-9中选择号码，可生成直选或组选组合</li>
                <li><strong>自定义选号</strong>：直接输入号码，支持空格、逗号、换行分隔</li>
                <li><strong>筛选功能</strong>：
                    <ul style="margin-left: 10px;">
                        <li><strong>胆码选杀</strong>：选码（包含任意一个选码即保留）和杀码（不包含所有杀码即保留）</li>
                        <li><strong>和值选杀</strong>：和值=百位+十位+个位，范围0-27</li>
                        <li><strong>和尾选杀</strong>：和尾=和值的个位数，范围0-9</li>
                        <li><strong>跨度选杀</strong>：跨度=最大数-最小数，范围0-9</li>
                        <li><strong>奇偶选杀</strong>：奇=1,3,5,7,9 偶=0,2,4,6,8</li>
                        <li><strong>大小选杀</strong>：大=5,6,7,8,9 小=0,1,2,3,4</li>
                    </ul>
                </li>
                <li>每注彩票金额为2元，计算结果将显示总注数和总金额</li>
                <li>如果你有好的想法意见建议请加v: <span class="contact">wss904</span></li>
            </ul>
        </div>
        
        <div class="footer">
            <p>3D选码计算神器 © 2023 | 本工具仅供模拟计算使用，实际投注请以官方规则为准</p>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ==================== 状态定义 ====================
            let selectedNumbers = {
                hundreds: [],
                tens: [],
                units: [],
                nonPositioned: []
            };

            let results = [];
            let filteredResults = [];
            let selectedResults = [];

            let currentSelectionType = 'non-positioned'; // 'positioned', 'non-positioned', 'custom'

            // 筛选条件存储 - 为每种选号类型独立保存
            const filterConditions = {
                'positioned': getDefaultFilterConditions(),
                'non-positioned': getDefaultFilterConditions(),
                'custom': getDefaultFilterConditions()
            };

            // 奇偶/大小组合定义
            const oddEvenPatterns = ['奇奇奇', '奇奇偶', '奇偶奇', '奇偶偶', '偶奇奇', '偶奇偶', '偶偶奇', '偶偶偶'];
            const sizePatterns = ['大大大', '大大小', '大小大', '大小小', '小大大', '小大小', '小小大', '小小小'];

            // ==================== 辅助函数 ====================
            function getDefaultFilterConditions() {
                return {
                    selectNumbers: [], killNumbers: [],
                    selectSumValues: [], killSumValues: [],
                    selectTailValues: [], killTailValues: [],
                    selectSpanValues: [], killSpanValues: [],
                    selectOddEvenPatterns: [], killOddEvenPatterns: [],
                    selectSizePatterns: [], killSizePatterns: []
                };
            }

            function getCurrentFilterConditions() {
                return filterConditions[currentSelectionType];
            }

            // 清除所有筛选active类
            function clearAllFilterActiveClasses() {
                document.querySelectorAll('.filter-number.active, .filter-option.active, .pattern-option.active').forEach(el => {
                    el.classList.remove('active');
                });
            }

            // 根据当前选号类型的条件，更新UI上的active类
            function applyFilterConditionsToUI() {
                clearAllFilterActiveClasses();
                const cond = getCurrentFilterConditions();

                // 选码
                cond.selectNumbers.forEach(num => {
                    const el = document.querySelector(`#selectNumbers .filter-number[data-number="${num}"]`);
                    if (el) el.classList.add('active');
                });
                // 杀码
                cond.killNumbers.forEach(num => {
                    const el = document.querySelector(`#killNumbers .filter-number[data-number="${num}"]`);
                    if (el) el.classList.add('active');
                });
                // 选和值
                cond.selectSumValues.forEach(val => {
                    const el = document.querySelector(`#selectSumValues .filter-option[data-value="${val}"]`);
                    if (el) el.classList.add('active');
                });
                // 杀和值
                cond.killSumValues.forEach(val => {
                    const el = document.querySelector(`#killSumValues .filter-option[data-value="${val}"]`);
                    if (el) el.classList.add('active');
                });
                // 选和尾
                cond.selectTailValues.forEach(num => {
                    const el = document.querySelector(`#selectTailValues .filter-number[data-number="${num}"]`);
                    if (el) el.classList.add('active');
                });
                // 杀和尾
                cond.killTailValues.forEach(num => {
                    const el = document.querySelector(`#killTailValues .filter-number[data-number="${num}"]`);
                    if (el) el.classList.add('active');
                });
                // 选跨度
                cond.selectSpanValues.forEach(num => {
                    const el = document.querySelector(`#selectSpanValues .filter-number[data-number="${num}"]`);
                    if (el) el.classList.add('active');
                });
                // 杀跨度
                cond.killSpanValues.forEach(num => {
                    const el = document.querySelector(`#killSpanValues .filter-number[data-number="${num}"]`);
                    if (el) el.classList.add('active');
                });
                // 选奇偶
                cond.selectOddEvenPatterns.forEach(pat => {
                    const el = document.querySelector(`#selectOddEvenPatterns .pattern-option[data-pattern="${pat}"]`);
                    if (el) el.classList.add('active');
                });
                // 杀奇偶
                cond.killOddEvenPatterns.forEach(pat => {
                    const el = document.querySelector(`#killOddEvenPatterns .pattern-option[data-pattern="${pat}"]`);
                    if (el) el.classList.add('active');
                });
                // 选大小
                cond.selectSizePatterns.forEach(pat => {
                    const el = document.querySelector(`#selectSizePatterns .pattern-option[data-pattern="${pat}"]`);
                    if (el) el.classList.add('active');
                });
                // 杀大小
                cond.killSizePatterns.forEach(pat => {
                    const el = document.querySelector(`#killSizePatterns .pattern-option[data-pattern="${pat}"]`);
                    if (el) el.classList.add('active');
                });
            }

            // 重置当前类型筛选条件为默认并更新UI
            function resetCurrentFilterConditions() {
                filterConditions[currentSelectionType] = getDefaultFilterConditions();
                clearAllFilterActiveClasses();
                // 无需再apply，因为已经是默认空
            }

            // ==================== UI初始化 ====================
            function initNumberSelection() {
                // 定位选号
                ['hundreds', 'tens', 'units'].forEach(pos => {
                    const container = document.getElementById(pos);
                    container.innerHTML = '';
                    for (let i = 0; i <= 9; i++) {
                        createNumberCheckbox(container, pos, i);
                    }
                });
                // 不定位
                const nonPosContainer = document.getElementById('nonPositionedNumbers');
                nonPosContainer.innerHTML = '';
                for (let i = 0; i <= 9; i++) {
                    createNumberCheckbox(nonPosContainer, 'nonPositioned', i);
                }
                // 筛选面板
                initFilterNumbers();
                // 折叠面板
                initAccordions();
                // 默认显示不定位，并加载其筛选条件（刚初始化为空，所以UI无active）
                showNonPositionedSelection();
            }

            function createNumberCheckbox(container, position, number) {
                const div = document.createElement('div');
                div.className = 'number-checkbox';
                const id = `${position}-${number}`;
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.id = id;
                cb.value = number;
                cb.dataset.position = position;
                const label = document.createElement('label');
                label.htmlFor = id;
                label.textContent = number;
                div.appendChild(cb);
                div.appendChild(label);
                container.appendChild(div);

                cb.addEventListener('change', function(e) {
                    const pos = this.dataset.position;
                    const num = parseInt(this.value);
                    if (this.checked) {
                        if (!selectedNumbers[pos].includes(num)) selectedNumbers[pos].push(num);
                    } else {
                        const idx = selectedNumbers[pos].indexOf(num);
                        if (idx !== -1) selectedNumbers[pos].splice(idx, 1);
                    }
                });
            }

            function initFilterNumbers() {
                // 选码/杀码 0-9
                for (let i = 0; i <= 9; i++) {
                    createFilterNumber('selectNumbers', i, 'select');
                    createFilterNumber('killNumbers', i, 'kill');
                    createFilterNumber('selectTailValues', i, 'select');
                    createFilterNumber('killTailValues', i, 'kill');
                    createFilterNumber('selectSpanValues', i, 'select');
                    createFilterNumber('killSpanValues', i, 'kill');
                }
                // 和值 0-27
                for (let i = 0; i <= 27; i++) {
                    createFilterOption('selectSumValues', i, 'select');
                    createFilterOption('killSumValues', i, 'kill');
                }
                // 奇偶
                oddEvenPatterns.forEach(p => createPatternOption('selectOddEvenPatterns', p, 'select'));
                oddEvenPatterns.forEach(p => createPatternOption('killOddEvenPatterns', p, 'kill'));
                // 大小
                sizePatterns.forEach(p => createPatternOption('selectSizePatterns', p, 'select'));
                sizePatterns.forEach(p => createPatternOption('killSizePatterns', p, 'kill'));
            }

            function createFilterNumber(containerId, number, type) {
                const container = document.getElementById(containerId);
                if (!container) return;
                const div = document.createElement('div');
                div.className = `filter-number ${type}`;
                div.textContent = number;
                div.dataset.number = number;
                div.dataset.type = type;
                container.appendChild(div);

                div.addEventListener('click', function() {
                    const num = parseInt(this.dataset.number);
                    const t = this.dataset.type;
                    // 根据父容器ID确定键名
                    const parentId = this.parentElement.id;
                    let key = '';
                    if (parentId.includes('select')) {
                        if (parentId.includes('Sum')) key = 'selectSumValues';
                        else if (parentId.includes('Tail')) key = 'selectTailValues';
                        else if (parentId.includes('Span')) key = 'selectSpanValues';
                        else key = 'selectNumbers';
                    } else {
                        if (parentId.includes('Sum')) key = 'killSumValues';
                        else if (parentId.includes('Tail')) key = 'killTailValues';
                        else if (parentId.includes('Span')) key = 'killSpanValues';
                        else key = 'killNumbers';
                    }
                    const cond = getCurrentFilterConditions();
                    const idx = cond[key].indexOf(num);
                    if (idx === -1) {
                        cond[key].push(num);
                        this.classList.add('active');
                    } else {
                        cond[key].splice(idx, 1);
                        this.classList.remove('active');
                    }
                });
            }

            function createFilterOption(containerId, value, type) {
                const container = document.getElementById(containerId);
                if (!container) return;
                const div = document.createElement('div');
                div.className = `filter-option ${type}`;
                div.textContent = value;
                div.dataset.value = value;
                div.dataset.type = type;
                container.appendChild(div);

                div.addEventListener('click', function() {
                    const val = parseInt(this.dataset.value);
                    const t = this.dataset.type;
                    const key = t === 'select' ? 'selectSumValues' : 'killSumValues';
                    const cond = getCurrentFilterConditions();
                    const idx = cond[key].indexOf(val);
                    if (idx === -1) {
                        cond[key].push(val);
                        this.classList.add('active');
                    } else {
                        cond[key].splice(idx, 1);
                        this.classList.remove('active');
                    }
                });
            }

            function createPatternOption(containerId, pattern, type) {
                const container = document.getElementById(containerId);
                if (!container) return;
                const div = document.createElement('div');
                div.className = `pattern-option ${type}`;
                div.textContent = pattern;
                div.dataset.pattern = pattern;
                div.dataset.type = type;
                container.appendChild(div);

                div.addEventListener('click', function() {
                    const pat = this.dataset.pattern;
                    const t = this.dataset.type;
                    const isOddEven = containerId.includes('OddEven');
                    let key;
                    if (t === 'select') {
                        key = isOddEven ? 'selectOddEvenPatterns' : 'selectSizePatterns';
                    } else {
                        key = isOddEven ? 'killOddEvenPatterns' : 'killSizePatterns';
                    }
                    const cond = getCurrentFilterConditions();
                    const idx = cond[key].indexOf(pat);
                    if (idx === -1) {
                        cond[key].push(pat);
                        this.classList.add('active');
                    } else {
                        cond[key].splice(idx, 1);
                        this.classList.remove('active');
                    }
                });
            }

            function initAccordions() {
                document.querySelectorAll('.filter-header').forEach(h => {
                    h.addEventListener('click', function() {
                        const target = document.getElementById(this.dataset.target);
                        const toggle = this.querySelector('.filter-toggle');
                        if (target.classList.contains('expanded')) {
                            target.classList.remove('expanded');
                            toggle.textContent = '+';
                        } else {
                            target.classList.add('expanded');
                            toggle.textContent = '-';
                        }
                    });
                });
            }

            // ==================== 视图切换 ====================
            function showPositionedSelection() {
                document.getElementById('positionedSelection').style.display = 'flex';
                document.getElementById('nonPositionedSelection').style.display = 'none';
                document.getElementById('customSelection').style.display = 'none';
                document.getElementById('conditionSection').style.display = 'block';
                document.getElementById('filterSection').style.display = 'block';

                document.getElementById('positionedOption').classList.add('active');
                document.getElementById('nonPositionedOption').classList.remove('active');
                document.getElementById('customOption').classList.remove('active');

                // 重置数字选区（不清除存储的筛选条件，仅重置勾选框）
                selectedNumbers.hundreds = [];
                selectedNumbers.tens = [];
                selectedNumbers.units = [];
                document.querySelectorAll('#hundreds input, #tens input, #units input').forEach(cb => cb.checked = false);

                // 加载当前类型对应的筛选条件到UI
                applyFilterConditionsToUI();
                clearResults();
            }

            function showNonPositionedSelection() {
                document.getElementById('positionedSelection').style.display = 'none';
                document.getElementById('nonPositionedSelection').style.display = 'block';
                document.getElementById('customSelection').style.display = 'none';
                document.getElementById('conditionSection').style.display = 'block';
                document.getElementById('filterSection').style.display = 'block';

                document.getElementById('positionedOption').classList.remove('active');
                document.getElementById('nonPositionedOption').classList.add('active');
                document.getElementById('customOption').classList.remove('active');

                selectedNumbers.nonPositioned = [];
                document.querySelectorAll('#nonPositionedNumbers input').forEach(cb => cb.checked = false);

                applyFilterConditionsToUI();
                clearResults();
            }

            function showCustomSelection() {
                document.getElementById('positionedSelection').style.display = 'none';
                document.getElementById('nonPositionedSelection').style.display = 'none';
                document.getElementById('customSelection').style.display = 'block';
                document.getElementById('conditionSection').style.display = 'none';
                document.getElementById('filterSection').style.display = 'block';

                document.getElementById('positionedOption').classList.remove('active');
                document.getElementById('nonPositionedOption').classList.remove('active');
                document.getElementById('customOption').classList.add('active');

                document.getElementById('customNumbers').value = '';

                applyFilterConditionsToUI();
                clearResults();
            }

            // ==================== 结果处理 ====================
            function clearResults() {
                results = [];
                filteredResults = [];
                selectedResults = [];
                document.getElementById('resultList').innerHTML = '<div class="empty-result">请选择号码并点击"开始分析"以查看结果</div>';
                document.getElementById('count').textContent = '0';
                document.getElementById('amount').textContent = '0';
                document.getElementById('resultCount').textContent = '0注/0元';
                hideErrorMessage();
            }

            function showErrorMessage(msg) {
                const err = document.getElementById('errorMessage');
                err.textContent = msg;
                err.style.display = 'block';
            }
            function hideErrorMessage() {
                document.getElementById('errorMessage').style.display = 'none';
            }

            // 计算和尾、跨度、模式等（函数与原版一致）
            function calculateTail(num) { return num.split('').map(Number).reduce((a,b)=>a+b,0) % 10; }
            function calculateSpan(num) { const d=num.split('').map(Number); return Math.max(...d)-Math.min(...d); }
            function getOddEvenPattern(num) { return num.split('').map(d => d%2?'奇':'偶').join(''); }
            function getSizePattern(num) { return num.split('').map(d => d>=5?'大':'小').join(''); }

            // 包含类型过滤
            function applyIncludeTypesFilter() {
                const inc3 = document.getElementById('group3').checked;
                const inc6 = document.getElementById('group6').checked;
                const incL = document.getElementById('leopard').checked;
                if (!inc3 && !inc6 && !incL) return; // 全不过滤
                results = results.filter(num => {
                    const d = num.split('').map(Number);
                    const isL = d[0]===d[1] && d[1]===d[2];
                    const is3 = !isL && (d[0]===d[1] || d[1]===d[2] || d[0]===d[2]);
                    const is6 = !isL && !is3;
                    return (isL && incL) || (is3 && inc3) || (is6 && inc6);
                });
            }

            // 生成号码（与原版一致）
            function generateStraightNumbers() {
                const h=selectedNumbers.hundreds, t=selectedNumbers.tens, u=selectedNumbers.units;
                for(let a of h) for(let b of t) for(let c of u) results.push(`${a}${b}${c}`);
            }
            function generateGroupNumbersFromPositioned() {
                const all = [...new Set([...selectedNumbers.hundreds, ...selectedNumbers.tens, ...selectedNumbers.units])];
                for(let i of all) for(let j of all) for(let k of all) {
                    const s = [i,j,k].sort().join('');
                    if(!results.includes(s)) results.push(s);
                }
            }
            function generateStraightNumbersNonPositioned() {
                const n = selectedNumbers.nonPositioned;
                for(let a of n) for(let b of n) for(let c of n) results.push(`${a}${b}${c}`);
            }
            function generateGroupNumbersNonPositioned() {
                const n = selectedNumbers.nonPositioned;
                for(let i=0;i<n.length;i++) for(let j=i;j<n.length;j++) for(let k=j;k<n.length;k++) {
                    results.push([n[i],n[j],n[k]].sort().join(''));
                }
            }

            // 筛选逻辑（与原版一致）
            function passNumberFilter(num, cond) {
                const d = num.split('').map(Number);
                if (cond.selectNumbers.length) {
                    let ok = false;
                    for (let x of cond.selectNumbers) if (d.includes(x)) { ok=true; break; }
                    if (!ok) return false;
                }
                if (cond.killNumbers.length) {
                    for (let x of cond.killNumbers) if (d.includes(x)) return false;
                }
                return true;
            }
            function passSumFilter(num, cond) {
                const s = num.split('').map(Number).reduce((a,b)=>a+b,0);
                if (cond.selectSumValues.length && !cond.selectSumValues.includes(s)) return false;
                if (cond.killSumValues.length && cond.killSumValues.includes(s)) return false;
                return true;
            }
            function passTailFilter(num, cond) {
                const t = calculateTail(num);
                if (cond.selectTailValues.length && !cond.selectTailValues.includes(t)) return false;
                if (cond.killTailValues.length && cond.killTailValues.includes(t)) return false;
                return true;
            }
            function passSpanFilter(num, cond) {
                const sp = calculateSpan(num);
                if (cond.selectSpanValues.length && !cond.selectSpanValues.includes(sp)) return false;
                if (cond.killSpanValues.length && cond.killSpanValues.includes(sp)) return false;
                return true;
            }
            function passOddEvenFilter(num, cond) {
                const p = getOddEvenPattern(num);
                if (cond.selectOddEvenPatterns.length && !cond.selectOddEvenPatterns.includes(p)) return false;
                if (cond.killOddEvenPatterns.length && cond.killOddEvenPatterns.includes(p)) return false;
                return true;
            }
            function passSizeFilter(num, cond) {
                const p = getSizePattern(num);
                if (cond.selectSizePatterns.length && !cond.selectSizePatterns.includes(p)) return false;
                if (cond.killSizePatterns.length && cond.killSizePatterns.includes(p)) return false;
                return true;
            }

            function applyFilters() {
                const cond = getCurrentFilterConditions();
                const hasFilters = Object.values(cond).some(arr => arr.length > 0);
                if (!hasFilters) {
                    filteredResults = [...results];
                    return;
                }
                filteredResults = results.filter(num => 
                    passNumberFilter(num, cond) &&
                    passSumFilter(num, cond) &&
                    passTailFilter(num, cond) &&
                    passSpanFilter(num, cond) &&
                    passOddEvenFilter(num, cond) &&
                    passSizeFilter(num, cond)
                );
            }

            function renderResultList() {
                const list = document.getElementById('resultList');
                list.innerHTML = '';
                if (filteredResults.length === 0) {
                    list.innerHTML = '<div class="empty-result">没有符合条件的号码</div>';
                    return;
                }
                filteredResults.forEach((num, idx) => {
                    const item = document.createElement('div');
                    item.className = 'number-item';
                    const cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.id = `res-${idx}`;
                    cb.value = num;
                    cb.checked = selectedResults.includes(num);
                    const label = document.createElement('label');
                    label.htmlFor = `res-${idx}`;
                    label.innerHTML = `<span>${num}</span>`;
                    item.appendChild(cb);
                    item.appendChild(label);
                    list.appendChild(item);
                    cb.addEventListener('change', function() {
                        if (this.checked) {
                            if (!selectedResults.includes(num)) selectedResults.push(num);
                        } else {
                            const i = selectedResults.indexOf(num);
                            if (i>-1) selectedResults.splice(i,1);
                        }
                    });
                });
            }

            function updateResultCount() {
                const cnt = filteredResults.length;
                document.getElementById('count').textContent = cnt;
                document.getElementById('amount').textContent = cnt * 2;
                document.getElementById('resultCount').textContent = `${cnt}注/${cnt*2}元`;
            }

            function calculateResults() {
                const type = currentSelectionType;
                const genType = document.querySelector('input[name="generateType"]:checked').value;
                let hasSel = false;
                let errMsg = '';

                if (type === 'positioned') {
                    hasSel = selectedNumbers.hundreds.length && selectedNumbers.tens.length && selectedNumbers.units.length;
                    if (!hasSel) errMsg = '请选择百位、十位和个位的数字';
                } else if (type === 'non-positioned') {
                    hasSel = selectedNumbers.nonPositioned.length > 0;
                    if (!hasSel) errMsg = '请选择数字';
                } else { // custom
                    const txt = document.getElementById('customNumbers').value.trim();
                    if (!txt) { errMsg = '请输入自定义号码'; }
                    else {
                        processCustomNumbers(txt);
                        return;
                    }
                }

                if (!hasSel) {
                    showErrorMessage(errMsg);
                    return;
                }
                hideErrorMessage();

                results = []; filteredResults = []; selectedResults = [];

                if (type === 'positioned') {
                    if (genType === 'straight') generateStraightNumbers();
                    else generateGroupNumbersFromPositioned();
                } else if (type === 'non-positioned') {
                    if (genType === 'straight') generateStraightNumbersNonPositioned();
                    else generateGroupNumbersNonPositioned();
                }

                applyIncludeTypesFilter();
                displayResults();
            }

            function displayResults() {
                if (results.length === 0) {
                    document.getElementById('resultList').innerHTML = '<div class="empty-result">没有符合条件的号码</div>';
                    document.getElementById('count').textContent = '0';
                    document.getElementById('amount').textContent = '0';
                    document.getElementById('resultCount').textContent = '0注/0元';
                    return;
                }
                filteredResults = [...results];
                applyFilters();
                renderResultList();
                updateResultCount();
            }

            function processCustomNumbers(text) {
                const nums = text.split(/[\s,;]+/).filter(s => s.length===3 && /^\d{3}$/.test(s));
                if (!nums.length) {
                    alert('未找到有效的3位号码，请确保格式正确（如：123 456 789）');
                    return;
                }
                results = [...new Set(nums)];
                filteredResults = [...results];
                selectedResults = [];
                renderResultList();
                updateResultCount();
                alert(`成功导入 ${results.length} 个号码`);
            }

            // ==================== 事件绑定 ====================
            document.querySelectorAll('input[name="selectionType"]').forEach(r => {
                r.addEventListener('change', function() {
                    currentSelectionType = this.value;
                    if (this.value === 'positioned') showPositionedSelection();
                    else if (this.value === 'non-positioned') showNonPositionedSelection();
                    else showCustomSelection();
                    hideErrorMessage();
                });
            });

            document.querySelectorAll('input[name="generateType"]').forEach(r => {
                r.addEventListener('change', function() {
                    document.querySelectorAll('.radio-option-type').forEach(o => o.classList.remove('active'));
                    if (this.value === 'straight') document.getElementById('straightOption').classList.add('active');
                    else document.getElementById('groupOption').classList.add('active');
                });
            });

            document.querySelectorAll('.quick-btn:not(#processCustomBtn)').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pos = this.dataset.position;
                    const type = this.dataset.type;
                    let nums = [];
                    if (type === 'odd') nums = [1,3,5,7,9];
                    else if (type === 'even') nums = [0,2,4,6,8];
                    else nums = [0,1,2,3,4,5,6,7,8,9];

                    const selector = pos === 'nonPositioned' ? '#nonPositionedNumbers input' : `#${pos} input`;
                    document.querySelectorAll(selector).forEach(cb => cb.checked = false);
                    selectedNumbers[pos] = [];

                    nums.forEach(n => {
                        const cb = document.getElementById(`${pos}-${n}`);
                        if (cb) {
                            cb.checked = true;
                            selectedNumbers[pos].push(n);
                        }
                    });
                });
            });

            document.getElementById('processCustomBtn').addEventListener('click', function() {
                const txt = document.getElementById('customNumbers').value.trim();
                if (!txt) alert('请输入或粘贴号码');
                else processCustomNumbers(txt);
            });

            document.getElementById('analyzeBtn').addEventListener('click', calculateResults);

            document.getElementById('applyFilter').addEventListener('click', function() {
                applyFilters();
                renderResultList();
                updateResultCount();
            });

            document.getElementById('clearFilter').addEventListener('click', function() {
                resetCurrentFilterConditions();
                // 重新应用筛选（此时条件为空，显示全部）
                applyFilters();
                renderResultList();
                updateResultCount();
            });

            document.getElementById('selectAllBtn').addEventListener('click', function() {
                selectedResults = [...filteredResults];
                document.querySelectorAll('#resultList input[type="checkbox"]').forEach(cb => cb.checked = true);
                alert(`已全选 ${selectedResults.length} 个号码`);
            });

            document.getElementById('cancelSelected').addEventListener('click', function() {
                selectedResults = [];
                document.querySelectorAll('#resultList input[type="checkbox"]').forEach(cb => cb.checked = false);
                alert('已取消所有选择');
            });

            document.getElementById('keepSelected').addEventListener('click', function() {
                if (!selectedResults.length) { alert('请先选择要保留的号码'); return; }
                results = [...selectedResults];
                filteredResults = [...selectedResults];
                selectedResults = [];
                renderResultList();
                updateResultCount();
            });

            document.getElementById('deleteSelected').addEventListener('click', function() {
                if (!selectedResults.length) { alert('请先选择要删除的号码'); return; }
                results = results.filter(n => !selectedResults.includes(n));
                filteredResults = filteredResults.filter(n => !selectedResults.includes(n));
                selectedResults = [];
                renderResultList();
                updateResultCount();
            });

            document.getElementById('copySelectedBtn').addEventListener('click', function() {
                let arr = selectedResults.length ? selectedResults : filteredResults;
                if (!arr.length) { alert('没有可复制的号码'); return; }
                let text = '';
                for (let i=0; i<arr.length; i+=7) text += arr.slice(i,i+7).join(' ') + '\n';
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => alert(`已复制 ${arr.length} 个号码`)).catch(() => fallbackCopy(text));
                } else fallbackCopy(text);
            });

            function fallbackCopy(t) {
                const ta = document.createElement('textarea');
                ta.value = t;
                ta.style.position = 'fixed'; ta.style.left = '-9999px';
                document.body.appendChild(ta);
                ta.select();
                try { document.execCommand('copy'); alert('已复制到剪贴板'); } catch(e) { alert('复制失败'); }
                document.body.removeChild(ta);
            }

            document.getElementById('exportText').addEventListener('click', function() {
                let arr = selectedResults.length ? selectedResults : filteredResults;
                if (!arr.length) { alert('没有可导出的号码'); return; }
                let rows = '';
                for (let i=0; i<arr.length; i+=7) rows += arr.slice(i,i+7).join(' ') + '\n';
                const content = '\uFEFF3D选号结果\n生成时间：' + new Date().toLocaleString() + '\n总注数：' + arr.length + '注\n总金额：' + (arr.length*2) + '元\n\n选号列表（每行7个）：\n' + rows;
                const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `3D选号_${Date.now()}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            });

            document.getElementById('resetBtn').addEventListener('click', function() {
                // 重置数字选择
                if (currentSelectionType === 'positioned') {
                    selectedNumbers.hundreds = []; selectedNumbers.tens = []; selectedNumbers.units = [];
                    document.querySelectorAll('#hundreds input, #tens input, #units input').forEach(cb => cb.checked = false);
                } else if (currentSelectionType === 'non-positioned') {
                    selectedNumbers.nonPositioned = [];
                    document.querySelectorAll('#nonPositionedNumbers input').forEach(cb => cb.checked = false);
                } else {
                    document.getElementById('customNumbers').value = '';
                }
                // 重置生成类型和包含类型为默认
                document.getElementById('straight').checked = true;
                document.getElementById('straightOption').classList.add('active');
                document.getElementById('groupOption').classList.remove('active');
                document.getElementById('group3').checked = true;
                document.getElementById('group6').checked = true;
                document.getElementById('leopard').checked = true;
                // 重置筛选条件
                resetCurrentFilterConditions();
                // 清空结果
                results = []; filteredResults = []; selectedResults = [];
                document.getElementById('resultList').innerHTML = '<div class="empty-result">请选择号码并点击"开始分析"以查看结果</div>';
                document.getElementById('count').textContent = '0';
                document.getElementById('amount').textContent = '0';
                document.getElementById('resultCount').textContent = '0注/0元';
                hideErrorMessage();
            });

            // 启动
            initNumberSelection();
        })();
    </script>
</body>
</html>
